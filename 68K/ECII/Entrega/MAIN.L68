000076F0 Starting Address
Assembler used: EASy68K Editor/Assembler v5.16.01
Created On: 27/01/2025 17:15:20

00000000                             1  *-----------------------------------------------------------
00000000                             2  * Title      :
00000000                             3  * Written by :
00000000                             4  * Date       :
00000000                             5  * Description:
00000000                             6  *-----------------------------------------------------------
00001000                             7      ORG    $1000
00001000                             8               INCLUDE "CONSTS.X68"
00001000                             9  ; =============================================================================
00001000                            10  ; SYSTEM CONSTANTS
00001000                            11  ; =============================================================================
00001000                            12  
00001000                            13  ;Datos de la imagen del jugador
00001000                            14  X:
00001000= 00000000 00000001 ...     15              DC.L 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14
0000103C= 0000000F 00000010 ...     16              DC.L 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 0, 1
00001078= 00000002 00000003 ...     17              DC.L 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16
000010B4= 00000011 00000012 ...     18              DC.L 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 0, 1, 2, 3
000010F0= 00000004 00000005 ...     19              DC.L 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18
0000112C= 00000013 00000014 ...     20              DC.L 19, 20, 21, 22, 23, 24, 25, 26, 27, 0, 1, 2, 3, 4, 5
00001168= 00000006 00000007 ...     21              DC.L 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20
000011A4= 00000015 00000016 ...     22              DC.L 21, 22, 23, 24, 25, 26, 27, 0, 1, 2, 3, 4, 5, 6, 7
000011E0= 00000008 00000009 ...     23              DC.L 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22
0000121C= 00000017 00000018 ...     24              DC.L 23, 24, 25, 26, 27, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9
00001258= 0000000A 0000000B ...     25              DC.L 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24
00001294= 00000019 0000001A ...     26              DC.L 25, 26, 27, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11
000012D0= 0000000C 0000000D ...     27              DC.L 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26
0000130C= 0000001B 00000000 ...     28              DC.L 27, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13
00001348= 0000000E 0000000F ...     29              DC.L 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 0
00001384= 00000001 00000002 ...     30              DC.L 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15
000013C0= 00000010 00000011 ...     31              DC.L 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 0, 1, 2
000013FC= 00000003 00000004 ...     32              DC.L 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17
00001438= 00000012 00000013 ...     33              DC.L 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 0, 1, 2, 3, 4
00001474= 00000005 00000006 ...     34              DC.L 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19
000014B0= 00000014 00000015 ...     35              DC.L 20, 21, 22, 23, 24, 25, 26, 27, 0, 1, 2, 3, 4, 5, 6
000014EC= 00000007 00000008 ...     36              DC.L 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21
00001528= 00000016 00000017 ...     37              DC.L 22, 23, 24, 25, 26, 27, 0, 1, 2, 3, 4, 5, 6, 7, 8
00001564= 00000009 0000000A ...     38              DC.L 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23
000015A0= 00000018 00000019 ...     39              DC.L 24, 25, 26, 27, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10
000015DC= 0000000B 0000000C ...     40              DC.L 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25
00001618= 0000001A 0000001B ...     41              DC.L 26, 27, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12
00001654= 0000000D 0000000E ...     42              DC.L 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27
00001690= 00000000 00000001 ...     43              DC.L 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14
000016CC= 0000000F 00000010 ...     44              DC.L 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 0, 1
00001708= 00000002 00000003 ...     45              DC.L 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16
00001744= 00000011 00000012 ...     46              DC.L 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 0, 1, 2, 3
00001780= 00000004 00000005 ...     47              DC.L 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18
000017BC= 00000013 00000014 ...     48              DC.L 19, 20, 21, 22, 23, 24, 25, 26, 27, 0, 1, 2, 3, 4, 5
000017F8= 00000006 00000007 ...     49              DC.L 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20
00001834= 00000015 00000016 ...     50              DC.L 21, 22, 23, 24, 25, 26, 27, 0, 1, 2, 3, 4, 5, 6, 7
00001870= 00000008 00000009 ...     51              DC.L 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22
000018AC= 00000017 00000018 ...     52              DC.L 23, 24, 25, 26, 27, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9
000018E8= 0000000A 0000000B ...     53              DC.L 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24
00001924= 00000019 0000001A ...     54              DC.L 25, 26, 27, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11
00001960= 0000000C 0000000D ...     55              DC.L 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26
0000199C= 0000001B 00000000 ...     56              DC.L 27, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13
000019D8= 0000000E 0000000F ...     57              DC.L 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 0
00001A14= 00000001 00000002 ...     58              DC.L 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15
00001A50= 00000010 00000011 ...     59              DC.L 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 0, 1, 2
00001A8C= 00000003 00000004 ...     60              DC.L 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17
00001AC8= 00000012 00000013 ...     61              DC.L 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 0, 1, 2, 3, 4
00001B04= 00000005 00000006 ...     62              DC.L 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19
00001B40= 00000014 00000015 ...     63              DC.L 20, 21, 22, 23, 24, 25, 26, 27, 0, 1, 2, 3, 4, 5, 6
00001B7C= 00000007 00000008 ...     64              DC.L 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21
00001BB8= 00000016 00000017 ...     65              DC.L 22, 23, 24, 25, 26, 27, 0, 1, 2, 3, 4, 5, 6, 7, 8
00001BF4= 00000009 0000000A ...     66              DC.L 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23
00001C30= 00000018 00000019 ...     67              DC.L 24, 25, 26, 27, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10
00001C6C= 0000000B 0000000C ...     68              DC.L 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25
00001CA8= 0000001A 0000001B ...     69              DC.L 26, 27, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12
00001CE4= 0000000D 0000000E ...     70              DC.L 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27
00001D20= 00000000 00000001 ...     71              DC.L 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14
00001D5C= 0000000F 00000010 ...     72              DC.L 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 0, 1
00001D98= 00000002 00000003 ...     73              DC.L 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16
00001DD4= 00000011 00000012 ...     74              DC.L 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27
00001E00                            75  Y:
00001E00= 00000000 00000000 ...     76              DC.L 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
00001E3C= 00000000 00000000 ...     77              DC.L 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1
00001E78= 00000001 00000001 ...     78              DC.L 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1
00001EB4= 00000001 00000001 ...     79              DC.L 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2
00001EF0= 00000002 00000002 ...     80              DC.L 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2
00001F2C= 00000002 00000002 ...     81              DC.L 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3
00001F68= 00000003 00000003 ...     82              DC.L 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3
00001FA4= 00000003 00000003 ...     83              DC.L 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4
00001FE0= 00000004 00000004 ...     84              DC.L 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4
0000201C= 00000004 00000004 ...     85              DC.L 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5
00002058= 00000005 00000005 ...     86              DC.L 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5
00002094= 00000005 00000005 ...     87              DC.L 5, 5, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6
000020D0= 00000006 00000006 ...     88              DC.L 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6
0000210C= 00000006 00000007 ...     89              DC.L 6, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7
00002148= 00000007 00000007 ...     90              DC.L 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 8
00002184= 00000008 00000008 ...     91              DC.L 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8
000021C0= 00000008 00000008 ...     92              DC.L 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 8, 9, 9, 9
000021FC= 00000009 00000009 ...     93              DC.L 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 9
00002238= 00000009 00000009 ...     94              DC.L 9, 9, 9, 9, 9, 9, 9, 9, 9, 9, 10, 10, 10, 10, 10
00002274= 0000000A 0000000A ...     95              DC.L 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10, 10
000022B0= 0000000A 0000000A ...     96              DC.L 10, 10, 10, 10, 10, 10, 10, 10, 11, 11, 11, 11, 11, 11, 11
000022EC= 0000000B 0000000B ...     97              DC.L 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11, 11
00002328= 0000000B 0000000B ...     98              DC.L 11, 11, 11, 11, 11, 11, 12, 12, 12, 12, 12, 12, 12, 12, 12
00002364= 0000000C 0000000C ...     99              DC.L 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12, 12
000023A0= 0000000C 0000000C ...    100              DC.L 12, 12, 12, 12, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13
000023DC= 0000000D 0000000D ...    101              DC.L 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13, 13
00002418= 0000000D 0000000D ...    102              DC.L 13, 13, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14
00002454= 0000000E 0000000E ...    103              DC.L 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14, 14
00002490= 0000000F 0000000F ...    104              DC.L 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15
000024CC= 0000000F 0000000F ...    105              DC.L 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 15, 16, 16
00002508= 00000010 00000010 ...    106              DC.L 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16
00002544= 00000010 00000010 ...    107              DC.L 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 17, 17, 17, 17
00002580= 00000011 00000011 ...    108              DC.L 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17, 17
000025BC= 00000011 00000011 ...    109              DC.L 17, 17, 17, 17, 17, 17, 17, 17, 17, 18, 18, 18, 18, 18, 18
000025F8= 00000012 00000012 ...    110              DC.L 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18, 18
00002634= 00000012 00000012 ...    111              DC.L 18, 18, 18, 18, 18, 18, 18, 19, 19, 19, 19, 19, 19, 19, 19
00002670= 00000013 00000013 ...    112              DC.L 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19, 19
000026AC= 00000013 00000013 ...    113              DC.L 19, 19, 19, 19, 19, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20
000026E8= 00000014 00000014 ...    114              DC.L 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20, 20
00002724= 00000014 00000014 ...    115              DC.L 20, 20, 20, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21
00002760= 00000015 00000015 ...    116              DC.L 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21, 21
0000279C= 00000015 00000016 ...    117              DC.L 21, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22
000027D8= 00000016 00000016 ...    118              DC.L 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 23
00002814= 00000017 00000017 ...    119              DC.L 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23
00002850= 00000017 00000017 ...    120              DC.L 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 23, 24, 24, 24
0000288C= 00000018 00000018 ...    121              DC.L 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 24
000028C8= 00000018 00000018 ...    122              DC.L 24, 24, 24, 24, 24, 24, 24, 24, 24, 24, 25, 25, 25, 25, 25
00002904= 00000019 00000019 ...    123              DC.L 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25
00002940= 00000019 00000019 ...    124              DC.L 25, 25, 25, 25, 25, 25, 25, 25, 26, 26, 26, 26, 26, 26, 26
0000297C= 0000001A 0000001A ...    125              DC.L 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26
000029B8= 0000001A 0000001A ...    126              DC.L 26, 26, 26, 26, 26, 26, 27, 27, 27, 27, 27, 27, 27, 27, 27
000029F4= 0000001B 0000001B ...    127              DC.L 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27, 27
00002A30= 0000001B 0000001B ...    128              DC.L 27, 27, 27, 27, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28
00002A6C= 0000001C 0000001C ...    129              DC.L 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28
00002AA8= 0000001C 0000001C ...    130              DC.L 28, 28, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29
00002AE4= 0000001D 0000001D ...    131              DC.L 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29, 29
00002B20= 0000001E 0000001E ...    132              DC.L 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30
00002B5C= 0000001E 0000001E ...    133              DC.L 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 31, 31
00002B98= 0000001F 0000001F ...    134              DC.L 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31
00002BD4= 0000001F 0000001F ...    135              DC.L 31, 31, 31, 31, 31, 31, 31, 31, 31, 31, 31
00002C00                           136  
00002C00                           137  
00002C00  =0000001E                138  PLRWIDTH    EQU     30                      ; PLAYER WIDTH (PIXELS)
00002C00  =0000001E                139  PLRHEIGH    EQU     30                      ; PLAYER HEIGHT (PIXELS)
00002C00                           140  
00002C00                           141  
00002C00                           142  ; --- PLAYER RELATED CONST -----------------------------------------------
00002C00                           143  
00002C00  =0000001E                144  PLRWIDTH    EQU     30                      ; PLAYER WIDTH (PIXELS)
00002C00  =0000001E                145  PLRHEIGH    EQU     30                      ; PLAYER HEIGHT (PIXELS)
00002C00  =00000006                146  PLRSPEEDX    EQU     6
00002C00  =00000014                147  PLRSPEEDY    EQU     20
00002C00                           148  
00002C00  =00000002                149  GRAVEDAD    EQU    2                        ;GRAVEDAD CONSTANTE QUE SIMPRE HARA QUE EL PERSONAJE CAIGA         
00002C00                           150  ; --- KEYBOARD RELATED CONSTS -----------------------------------------------
00002C00  =00000000                151  KBDTRAP     EQU     0                       ; KEYBOARD UPDATE TRAP
00002C00                           152  
00002C00  =00000053                153  KBDDOWN     EQU     'S'
00002C00  =00000044                154  KBDRIGHT    EQU     'D'
00002C00  =00000057                155  KBDUP       EQU     'W'
00002C00  =00000041                156  KBDLEFT     EQU     'A'
00002C00  =00000020                157  KBDSHIELD   EQU     $20
00002C00                           158  
00002C00                           159  
00002C00                           160  
00002C00                           161  ; --- BALL RELATED VARIABLES ---------------------------------------------------
00002C00                           162  
00002C00                           163  
00002C00  =00000003                164  BALVEL      EQU     3
00002C00  =00000014                165  BALRAD      EQU     20
00002C00                           166  BALPRV1     DS.W    1
00002C02                           167  BALPRV2     DS.W    1
00002C04                           168  
00002C04                           169      
00002C04                           170  ; --- SCREEN RELATED CONSTS ---------------------------------------------
00002C04  =00000280                171  SCRWIDTH    EQU     640                     ; SCREEN WIDTH (PIXELS)
00002C04  =000001E0                172  SCRHEIGH    EQU     480                     ; SCREEN HEIGHT (PIXELS)
00002C04  =00000001                173  SCRIRQ      EQU     1                       ; SCREEN INTERRUPT NUMBER
00002C04= 54 49 4D 45 52 3A ...    174  TIMER    DC.B 'TIMER: ',0   ; "TIMER: " seguido de CR y LF, terminado en NULL
00002C0C= 0D 0A 53 48 49 45 ...    175  SHIELD      DC.B    $0D, $0A,'SHIELD: ',0 ;
00002C17= 0D 0A 54 45 4C 45 ...    176  TELEPORT    DC.B    $0D, $0A,'TELEPORT: ',0           
00002C24  =00000001                177  SCRTRAP     EQU     1
00002C24= 20 20 20 20 20 20 ...    178  TXTFPS      DC.B    '                                                     GOAL: ',0
00002C60                           179  
00002C60= 20 41 43 54 55 41 ...    180  TXT2FPS     DC.B    ' ACTUAL: ' ,0
00002C6A                           181  ;Mensaje game over
00002C6A= 0D 0A 0D 0A 0D 0A ...    182  GAMEOVER1   DC.B    $0D, $0A,$0D, $0A,$0D, $0A,$0D, $0A,$0D, $0A,'                                    GAME OVER!',0
00002CA3= 0D 0A 20 20 20 20 ...    183  GAMEOVER2   DC.B    $0D, $0A,'                     YOU FAILED TO OVERCOME THE CHALLENGE.',0
00002CE0= 0D 0A 20 20 20 20 ...    184  GAMEOVER3   DC.B    $0D, $0A,'             DUE TO LOSING IN THIS GAME IN THE MIND OF JESUS CHRIST',0
00002D26= 0D 0A 20 20 20 20 ...    185  GAMEOVER4   DC.B    $0D, $0A,'                   HE HAS DIED AND WILL NOT BE ABLE TO RESURRECT,',0
00002D6A= 0D 0A 20 20 20 20 ...    186  GAMEOVER5   DC.B    $0D, $0A,'                     FOLLOWING THE EVENTS OF THE BIBLE.',0
00002DA4                           187  
00002DA4                           188  ;Mensaje de ganar
00002DA4= 0D 0A 0D 0A 0D 0A ...    189  WIN1 DC.B    $0D, $0A,$0D, $0A,$0D, $0A,$0D, $0A,$0D, $0A,'                                    YOU WON!',0
00002DDB= 0D 0A 20 20 20 20 ...    190  WIN2 DC.B    $0D, $0A,'                     JESUS CHRIST RESURRECTED THANKS TO YOUR HELP.',0
00002E20                           191        
00002E20                           192  
00002E20  =00000001                193  SCRTRAP     EQU     1
00002E20  =00000032                194  FPS         EQU     50
00002E20                           195  ;-----------------MOUSE DECLARATIONS CONSTS----------
00002E20  =00000002                196  MOUSETRAP   EQU     2
00002E20                           197  
00002E20                           198  
00002E20                           199  ;----------SHIELD DECLARATIONS CONSTS
00002E20  =00000050                200  SHIELDPOSX  EQU 80
00002E20  =00000000                201  SHIELDPOSY  EQU 0
00002E20  =0000002D                202  SHIELDATA  EQU  45
00002E20                           203  
00002E20                           204  
00002E20                           205  
00002E20                           206  ;---------------FILES DECLARATIONS-------------
00002E20                           207  
00002E20                           208  PIXEL      DS.B 4096
00003E20                           209  WINPIX     DS.B 4096
00004E20                           210  
00004E20                           211  
00004E20                           212  
00004E20                           213  ;------------------FILENAMES-----------
00004E20= 64 61 74 6F 73 5F ...    214  FILENAMEPIX   DC.B    'datos_pixeles.bin',0
00004E32= 64 61 74 6F 73 5F ...    215  FILENAMEWIN    DC.B   'datos_ganaste.bin',0
00004E44                           216  
00004E44                           217  
00004E44                           218  
00004E44                           219  ;------------PLATFORM-----------
00004E44  =0000000F                220  CALTURA     EQU 15
00004E44  =00000064                221  CANCHURA    EQU 100
00004E44                           222  
00004E44                           223  ;Datos de la imagen de ganar
00004E44                           224  X1:
00004E44= 0000 0001 0002 0...      225              DC.W 0,1,2,3,4,5,6,7,8,9,10,11,12,13,14
00004E62= 000F 0010 0011 0...      226              DC.W 15,16,17,18,19,20,21,22,23,24,25,26,27,28,29
00004E80= 001E 001F 0000 0...      227              DC.W 30,31,0,1,2,3,4,5,6,7,8,9,10,11,12
00004E9E= 000D 000E 000F 0...      228              DC.W 13,14,15,16,17,18,19,20,21,22,23,24,25,26,27
00004EBC= 001C 001D 001E 0...      229              DC.W 28,29,30,31,0,1,2,3,4,5,6,7,8,9,10
00004EDA= 000B 000C 000D 0...      230              DC.W 11,12,13,14,15,16,17,18,19,20,21,22,23,24,25
00004EF8= 001A 001B 001C 0...      231              DC.W 26,27,28,29,30,31,0,1,2,3,4,5,6,7,8
00004F16= 0009 000A 000B 0...      232              DC.W 9,10,11,12,13,14,15,16,17,18,19,20,21,22,23
00004F34= 0018 0019 001A 0...      233              DC.W 24,25,26,27,28,29,30,31,0,1,2,3,4,5,6
00004F52= 0007 0008 0009 0...      234              DC.W 7,8,9,10,11,12,13,14,15,16,17,18,19,20,21
00004F70= 0016 0017 0018 0...      235              DC.W 22,23,24,25,26,27,28,29,30,31,0,1,2,3,4
00004F8E= 0005 0006 0007 0...      236              DC.W 5,6,7,8,9,10,11,12,13,14,15,16,17,18,19
00004FAC= 0014 0015 0016 0...      237              DC.W 20,21,22,23,24,25,26,27,28,29,30,31,0,1,2
00004FCA= 0003 0004 0005 0...      238              DC.W 3,4,5,6,7,8,9,10,11,12,13,14,15,16,17
00004FE8= 0012 0013 0014 0...      239              DC.W 18,19,20,21,22,23,24,25,26,27,28,29,30,31,0
00005006= 0001 0002 0003 0...      240              DC.W 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15
00005024= 0010 0011 0012 0...      241              DC.W 16,17,18,19,20,21,22,23,24,25,26,27,28,29,30
00005042= 001F 0000 0001 0...      242              DC.W 31,0,1,2,3,4,5,6,7,8,9,10,11,12,13
00005060= 000E 000F 0010 0...      243              DC.W 14,15,16,17,18,19,20,21,22,23,24,25,26,27,28
0000507E= 001D 001E 001F 0...      244              DC.W 29,30,31,0,1,2,3,4,5,6,7,8,9,10,11
0000509C= 000C 000D 000E 0...      245              DC.W 12,13,14,15,16,17,18,19,20,21,22,23,24,25,26
000050BA= 001B 001C 001D 0...      246              DC.W 27,28,29,30,31,0,1,2,3,4,5,6,7,8,9
000050D8= 000A 000B 000C 0...      247              DC.W 10,11,12,13,14,15,16,17,18,19,20,21,22,23,24
000050F6= 0019 001A 001B 0...      248              DC.W 25,26,27,28,29,30,31,0,1,2,3,4,5,6,7
00005114= 0008 0009 000A 0...      249              DC.W 8,9,10,11,12,13,14,15,16,17,18,19,20,21,22
00005132= 0017 0018 0019 0...      250              DC.W 23,24,25,26,27,28,29,30,31,0,1,2,3,4,5
00005150= 0006 0007 0008 0...      251              DC.W 6,7,8,9,10,11,12,13,14,15,16,17,18,19,20
0000516E= 0015 0016 0017 0...      252              DC.W 21,22,23,24,25,26,27,28,29,30,31,0,1,2,3
0000518C= 0004 0005 0006 0...      253              DC.W 4,5,6,7,8,9,10,11,12,13,14,15,16,17,18
000051AA= 0013 0014 0015 0...      254              DC.W 19,20,21,22,23,24,25,26,27,28,29,30,31,0,1
000051C8= 0002 0003 0004 0...      255              DC.W 2,3,4,5,6,7,8,9,10,11,12,13,14,15,16
000051E6= 0011 0012 0013 0...      256              DC.W 17,18,19,20,21,22,23,24,25,26,27,28,29,30,31
00005204= 0000 0001 0002 0...      257              DC.W 0,1,2,3,4,5,6,7,8,9,10,11,12,13,14
00005222= 000F 0010 0011 0...      258              DC.W 15,16,17,18,19,20,21,22,23,24,25,26,27,28,29
00005240= 001E 001F 0000 0...      259              DC.W 30,31,0,1,2,3,4,5,6,7,8,9,10,11,12
0000525E= 000D 000E 000F 0...      260              DC.W 13,14,15,16,17,18,19,20,21,22,23,24,25,26,27
0000527C= 001C 001D 001E 0...      261              DC.W 28,29,30,31,0,1,2,3,4,5,6,7,8,9,10
0000529A= 000B 000C 000D 0...      262              DC.W 11,12,13,14,15,16,17,18,19,20,21,22,23,24,25
000052B8= 001A 001B 001C 0...      263              DC.W 26,27,28,29,30,31,0,1,2,3,4,5,6,7,8
000052D6= 0009 000A 000B 0...      264              DC.W 9,10,11,12,13,14,15,16,17,18,19,20,21,22,23
000052F4= 0018 0019 001A 0...      265              DC.W 24,25,26,27,28,29,30,31,0,1,2,3,4,5,6
00005312= 0007 0008 0009 0...      266              DC.W 7,8,9,10,11,12,13,14,15,16,17,18,19,20,21
00005330= 0016 0017 0018 0...      267              DC.W 22,23,24,25,26,27,28,29,30,31,0,1,2,3,4
0000534E= 0005 0006 0007 0...      268              DC.W 5,6,7,8,9,10,11,12,13,14,15,16,17,18,19
0000536C= 0014 0015 0016 0...      269              DC.W 20,21,22,23,24,25,26,27,28,29,30,31,0,1,2
0000538A= 0003 0004 0005 0...      270              DC.W 3,4,5,6,7,8,9,10,11,12,13,14,15,16,17
000053A8= 0012 0013 0014 0...      271              DC.W 18,19,20,21,22,23,24,25,26,27,28,29,30,31,0
000053C6= 0001 0002 0003 0...      272              DC.W 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15
000053E4= 0010 0011 0012 0...      273              DC.W 16,17,18,19,20,21,22,23,24,25,26,27,28,29,30
00005402= 001F 0000 0001 0...      274              DC.W 31,0,1,2,3,4,5,6,7,8,9,10,11,12,13
00005420= 000E 000F 0010 0...      275              DC.W 14,15,16,17,18,19,20,21,22,23,24,25,26,27,28
0000543E= 001D 001E 001F 0...      276              DC.W 29,30,31,0,1,2,3,4,5,6,7,8,9,10,11
0000545C= 000C 000D 000E 0...      277              DC.W 12,13,14,15,16,17,18,19,20,21,22,23,24,25,26
0000547A= 001B 001C 001D 0...      278              DC.W 27,28,29,30,31,0,1,2,3,4,5,6,7,8,9
00005498= 000A 000B 000C 0...      279              DC.W 10,11,12,13,14,15,16,17,18,19,20,21,22,23,24
000054B6= 0019 001A 001B 0...      280              DC.W 25,26,27,28,29,30,31,0,1,2,3,4,5,6,7
000054D4= 0008 0009 000A 0...      281              DC.W 8,9,10,11,12,13,14,15,16,17,18,19,20,21,22
000054F2= 0017 0018 0019 0...      282              DC.W 23,24,25,26,27,28,29,30,31,0,1,2,3,4,5
00005510= 0006 0007 0008 0...      283              DC.W 6,7,8,9,10,11,12,13,14,15,16,17,18,19,20
0000552E= 0015 0016 0017 0...      284              DC.W 21,22,23,24,25,26,27,28,29,30,31,0,1,2,3
0000554C= 0004 0005 0006 0...      285              DC.W 4,5,6,7,8,9,10,11,12,13,14,15,16,17,18
0000556A= 0013 0014 0015 0...      286              DC.W 19,20,21,22,23,24,25,26,27,28,29,30,31,0,1
00005588= 0002 0003 0004 0...      287              DC.W 2,3,4,5,6,7,8,9,10,11,12,13,14,15,16
000055A6= 0011 0012 0013 0...      288              DC.W 17,18,19,20,21,22,23,24,25,26,27,28,29,30,31
000055C4= 0000 0001 0002 0...      289              DC.W 0,1,2,3,4,5,6,7,8,9,10,11,12,13,14
000055E2= 000F 0010 0011 0...      290              DC.W 15,16,17,18,19,20,21,22,23,24,25,26,27,28,29
00005600= 001E 001F 0000 0...      291              DC.W 30,31,0,1,2,3,4,5,6,7,8,9,10,11,12
0000561E= 000D 000E 000F 0...      292              DC.W 13,14,15,16,17,18,19,20,21,22,23,24,25,26,27
0000563C= 001C 001D 001E 001F      293              DC.W 28,29,30,31
00005644                           294              
00005644                           295              
00005644                           296              
00005644                           297  Y1:
00005644= 0000 0000 0000 0...      298              DC.W 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
00005662= 0000 0000 0000 0...      299              DC.W 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
00005680= 0000 0000 0001 0...      300              DC.W 0,0,1,1,1,1,1,1,1,1,1,1,1,1,1
0000569E= 0001 0001 0001 0...      301              DC.W 1,1,1,1,1,1,1,1,1,1,1,1,1,1,1
000056BC= 0001 0001 0001 0...      302              DC.W 1,1,1,1,2,2,2,2,2,2,2,2,2,2,2
000056DA= 0002 0002 0002 0...      303              DC.W 2,2,2,2,2,2,2,2,2,2,2,2,2,2,2
000056F8= 0002 0002 0002 0...      304              DC.W 2,2,2,2,2,2,3,3,3,3,3,3,3,3,3
00005716= 0003 0003 0003 0...      305              DC.W 3,3,3,3,3,3,3,3,3,3,3,3,3,3,3
00005734= 0003 0003 0003 0...      306              DC.W 3,3,3,3,3,3,3,3,4,4,4,4,4,4,4
00005752= 0004 0004 0004 0...      307              DC.W 4,4,4,4,4,4,4,4,4,4,4,4,4,4,4
00005770= 0004 0004 0004 0...      308              DC.W 4,4,4,4,4,4,4,4,4,4,5,5,5,5,5
0000578E= 0005 0005 0005 0...      309              DC.W 5,5,5,5,5,5,5,5,5,5,5,5,5,5,5
000057AC= 0005 0005 0005 0...      310              DC.W 5,5,5,5,5,5,5,5,5,5,5,5,6,6,6
000057CA= 0006 0006 0006 0...      311              DC.W 6,6,6,6,6,6,6,6,6,6,6,6,6,6,6
000057E8= 0006 0006 0006 0...      312              DC.W 6,6,6,6,6,6,6,6,6,6,6,6,6,6,7
00005806= 0007 0007 0007 0...      313              DC.W 7,7,7,7,7,7,7,7,7,7,7,7,7,7,7
00005824= 0007 0007 0007 0...      314              DC.W 7,7,7,7,7,7,7,7,7,7,7,7,7,7,7
00005842= 0007 0008 0008 0...      315              DC.W 7,8,8,8,8,8,8,8,8,8,8,8,8,8,8
00005860= 0008 0008 0008 0...      316              DC.W 8,8,8,8,8,8,8,8,8,8,8,8,8,8,8
0000587E= 0008 0008 0008 0...      317              DC.W 8,8,8,9,9,9,9,9,9,9,9,9,9,9,9
0000589C= 0009 0009 0009 0...      318              DC.W 9,9,9,9,9,9,9,9,9,9,9,9,9,9,9
000058BA= 0009 0009 0009 0...      319              DC.W 9,9,9,9,9,10,10,10,10,10,10,10,10,10,10
000058D8= 000A 000A 000A 0...      320              DC.W 10,10,10,10,10,10,10,10,10,10,10,10,10,10,10
000058F6= 000A 000A 000A 0...      321              DC.W 10,10,10,10,10,10,10,11,11,11,11,11,11,11,11
00005914= 000B 000B 000B 0...      322              DC.W 11,11,11,11,11,11,11,11,11,11,11,11,11,11,11
00005932= 000B 000B 000B 0...      323              DC.W 11,11,11,11,11,11,11,11,11,12,12,12,12,12,12
00005950= 000C 000C 000C 0...      324              DC.W 12,12,12,12,12,12,12,12,12,12,12,12,12,12,12
0000596E= 000C 000C 000C 0...      325              DC.W 12,12,12,12,12,12,12,12,12,12,12,13,13,13,13
0000598C= 000D 000D 000D 0...      326              DC.W 13,13,13,13,13,13,13,13,13,13,13,13,13,13,13
000059AA= 000D 000D 000D 0...      327              DC.W 13,13,13,13,13,13,13,13,13,13,13,13,13,14,14
000059C8= 000E 000E 000E 0...      328              DC.W 14,14,14,14,14,14,14,14,14,14,14,14,14,14,14
000059E6= 000E 000E 000E 0...      329              DC.W 14,14,14,14,14,14,14,14,14,14,14,14,14,14,14
00005A04= 000F 000F 000F 0...      330              DC.W 15,15,15,15,15,15,15,15,15,15,15,15,15,15,15
00005A22= 000F 000F 000F 0...      331              DC.W 15,15,15,15,15,15,15,15,15,15,15,15,15,15,15
00005A40= 000F 000F 0010 0...      332              DC.W 15,15,16,16,16,16,16,16,16,16,16,16,16,16,16
00005A5E= 0010 0010 0010 0...      333              DC.W 16,16,16,16,16,16,16,16,16,16,16,16,16,16,16
00005A7C= 0010 0010 0010 0...      334              DC.W 16,16,16,16,17,17,17,17,17,17,17,17,17,17,17
00005A9A= 0011 0011 0011 0...      335              DC.W 17,17,17,17,17,17,17,17,17,17,17,17,17,17,17
00005AB8= 0011 0011 0011 0...      336              DC.W 17,17,17,17,17,17,18,18,18,18,18,18,18,18,18
00005AD6= 0012 0012 0012 0...      337              DC.W 18,18,18,18,18,18,18,18,18,18,18,18,18,18,18
00005AF4= 0012 0012 0012 0...      338              DC.W 18,18,18,18,18,18,18,18,19,19,19,19,19,19,19
00005B12= 0013 0013 0013 0...      339              DC.W 19,19,19,19,19,19,19,19,19,19,19,19,19,19,19
00005B30= 0013 0013 0013 0...      340              DC.W 19,19,19,19,19,19,19,19,19,19,20,20,20,20,20
00005B4E= 0014 0014 0014 0...      341              DC.W 20,20,20,20,20,20,20,20,20,20,20,20,20,20,20
00005B6C= 0014 0014 0014 0...      342              DC.W 20,20,20,20,20,20,20,20,20,20,20,20,21,21,21
00005B8A= 0015 0015 0015 0...      343              DC.W 21,21,21,21,21,21,21,21,21,21,21,21,21,21,21
00005BA8= 0015 0015 0015 0...      344              DC.W 21,21,21,21,21,21,21,21,21,21,21,21,21,21,22
00005BC6= 0016 0016 0016 0...      345              DC.W 22,22,22,22,22,22,22,22,22,22,22,22,22,22,22
00005BE4= 0016 0016 0016 0...      346              DC.W 22,22,22,22,22,22,22,22,22,22,22,22,22,22,22
00005C02= 0016 0017 0017 0...      347              DC.W 22,23,23,23,23,23,23,23,23,23,23,23,23,23,23
00005C20= 0017 0017 0017 0...      348              DC.W 23,23,23,23,23,23,23,23,23,23,23,23,23,23,23
00005C3E= 0017 0017 0017 0...      349              DC.W 23,23,23,24,24,24,24,24,24,24,24,24,24,24,24
00005C5C= 0018 0018 0018 0...      350              DC.W 24,24,24,24,24,24,24,24,24,24,24,24,24,24,24
00005C7A= 0018 0018 0018 0...      351              DC.W 24,24,24,24,24,25,25,25,25,25,25,25,25,25,25
00005C98= 0019 0019 0019 0...      352              DC.W 25,25,25,25,25,25,25,25,25,25,25,25,25,25,25
00005CB6= 0019 0019 0019 0...      353              DC.W 25,25,25,25,25,25,25,26,26,26,26,26,26,26,26
00005CD4= 001A 001A 001A 0...      354              DC.W 26,26,26,26,26,26,26,26,26,26,26,26,26,26,26
00005CF2= 001A 001A 001A 0...      355              DC.W 26,26,26,26,26,26,26,26,26,27,27,27,27,27,27
00005D10= 001B 001B 001B 0...      356              DC.W 27,27,27,27,27,27,27,27,27,27,27,27,27,27,27
00005D2E= 001B 001B 001B 0...      357              DC.W 27,27,27,27,27,27,27,27,27,27,27,28,28,28,28
00005D4C= 001C 001C 001C 0...      358              DC.W 28,28,28,28,28,28,28,28,28,28,28,28,28,28,28
00005D6A= 001C 001C 001C 0...      359              DC.W 28,28,28,28,28,28,28,28,28,28,28,28,28,29,29
00005D88= 001D 001D 001D 0...      360              DC.W 29,29,29,29,29,29,29,29,29,29,29,29,29,29,29
00005DA6= 001D 001D 001D 0...      361              DC.W 29,29,29,29,29,29,29,29,29,29,29,29,29,29,29
00005DC4= 001E 001E 001E 0...      362              DC.W 30,30,30,30,30,30,30,30,30,30,30,30,30,30,30
00005DE2= 001E 001E 001E 0...      363              DC.W 30,30,30,30,30,30,30,30,30,30,30,30,30,30,30
00005E00= 001E 001E 001F 0...      364              DC.W 30,30,31,31,31,31,31,31,31,31,31,31,31,31,31
00005E1E= 001F 001F 001F 0...      365              DC.W 31,31,31,31,31,31,31,31,31,31,31,31,31,31,31
00005E3C= 001F 001F 001F 001F      366              DC.W 31,31,31,31
00005E44                           367  
00005E44                           368  ;Desplazamiento para la colocación de la imagen
00005E44  =0000012C                369  DSPLZ1      EQU     300
00005E44  =0000006E                370  DSPLZ2      EQU     110
00005E44                           371  
00005E44                           372  
00005E44                           373              DS.W    0
00005E44                           374  
00005E44                           375  
00005E44                           376  
00005E44                           377  
00005E44                           378  
00005E44                           379  -------------------- end include --------------------
00005E44                           380              INCLUDE "VARS.X68"
00005E44                           381  ; =============================================================================
00005E44                           382  ; GAME VARS
00005E44                           383  ; =============================================================================
00005E44                           384  
00005E44                           385  ; --- TIMED INTERRUPT RELATED VARIABLES ----------------------------------------
00005E44                           386  
00005E44                           387  SCRINTCT    DS.B    1                       ; INTERRUPT COUNTER
00005E45                           388  SCRCYCCT    DS.B    1                       ; CYCLE COUNTER
00005E46                           389              DS.W    1
00005E48                           390  ERROR       DS.W    1                       ;ERROR DE LOS FPS
00005E4A                           391  FPSAC       DS.L    1
00005E4E                           392  FPSIN       DS.L    1
00005E52                           393  ENFPS       DS.W    1
00005E54                           394  FPSAN       DS.W    1
00005E56                           395  ; --- GAME STATE RELATED VARIABLES --------------------------------------------
00005E56                           396  
00005E56                           397  STACUR      DS.W    1                       ; CURRENT GAME STATE
00005E58                           398  STANEXT     DS.W    1                       ; NEXT GAME STATE
00005E5A                           399  ; --- KEYBOARD RELATED VARIABLES -----------------------------------------------
00005E5A                           400  
00005E5A                           401  KBDVAL      DS.B    1                       ; KEY STATE
00005E5B                           402  KBDEDGE     DS.B    1                       ; KEY EDGE
00005E5C                           403  
00005E5C                           404  ; --- PLAYER RELATED VARIABLES ------------------------------------------------
00005E5C                           405  
00005E5C                           406  PLRPOSX     DS.W    1                       ; PLAYER X POSITION (PIXELS)
00005E5E                           407  PLRPOSY     DS.W    1                       ; PLAYER Y POSITION (PIXELS)
00005E60                           408  PLRENER     DS.W    1                       ; PLAYER ENERGY
00005E62                           409  PLRDMG      DS.B    1                       ; BIT0: UPD DAMAGE, BIT1 PLOT DMG
00005E64                           410              DS.W    0
00005E64                           411  
00005E64                           412              
00005E64                           413  VGRAVEDAD   DS.W    1 
00005E66                           414  
00005E66                           415  ; --- SCREEN RELATED VARIABLES ---------------------------------------------
00005E66                           416  
00005E66                           417  VTIMER      DS.W    1                       ;VALOR EN SEGUNDOS
00005E68                           418  SEGUNDOS    DS.W    1
00005E6A                           419  POINT       DS.W    1                          ;PUNTOS CONSEGUIDOS  
00005E6C                           420  
00005E6C                           421  ;-----------------MOUSE DECLARATIONS VARS----------
00005E6C                           422  ENATP       DS.W    1
00005E6E                           423  LASTENA     DS.W    1
00005E70                           424  MOUSEPOSX   DS.W    1
00005E72                           425  MOUSEPOSY   DS.W    1
00005E74                           426  TIMEENABLE  DS.W    1
00005E76                           427  
00005E76                           428  ;----------SHIELD DECLARATIONS VARS
00005E76                           429  SHIELDENA   DS.W 1
00005E78                           430  SHIELDTIMEEN DS.W 1
00005E7A                           431  SHIELDCOOLDOWN DS.W 1
00005E7C                           432  SHIELDINICIO DS.W 1
00005E7E                           433  ;---------------PLATFORM DECLARATION VARS
00005E7E                           434  XCENTER     DS.W 1
00005E80                           435  YCENTER     DS.W 1
00005E82                           436  MOVIMIENTO  DS.W 1
00005E84                           437  PLTEN       DS.W    1
00005E86                           438  PLTEN1      DS.W    1
00005E88                           439  ;BALLS
00005E88                           440  BALEN       DS.W    1
00005E8A                           441  
00005E8A                           442  
00005E8A                           443  
00005E8A                           444  
00005E8A                           445  
00005E8A                           446  
00005E8A                           447  -------------------- end include --------------------
00005E8A                           448               INCLUDE "SYS.X68"
00005E8A                           449  ; =============================================================================
00005E8A                           450  ; TITLE    : SYSTEM MANAGEMENT (SYSTEM CODE)
00005E8A                           451  ; AUTHOR   : Juan, Antonio y Jia Sheng
00005E8A                           452  ; COMMENTS : IT IS DIVIDED IN THREE BLOCKS:
00005E8A                           453  ;            - SYS : GENERIC.
00005E8A                           454  ;            - SCR : SCREEN MANAGEMENT.
00005E8A                           455  ;            - KBD : KEYBOARD MANAGEMENT.
00005E8A                           456  ;            - MOUSE : MOUSE MANAGEMENT
00005E8A                           457  ;            - FIL : FILES MANAGEMENT
00005E8A                           458  ;            - FPS : FPS MANAGEMENT
00005E8A                           459  ; =============================================================================
00005E8A                           460  
00005E8A                           461  ; =============================================================================
00005E8A                           462  SCRISR
00005E8A                           463  ; SCREEN TIMER ISR. INCREASES THE INTERRUPT COUNTER AND UPDATES DOUBLE BUFFER.
00005E8A                           464  ; INPUT    - NONE
00005E8A                           465  ; OUTPUT   - NONE
00005E8A                           466  ; MODIFIES - NONE
00005E8A                           467  ; -----------------------------------------------------------------------------
00005E8A  5238 5E44                468              ADDQ.B  #1,(SCRINTCT)           ; ACTUALIZA INT FLAG/CONTADOR
00005E8E  5238 5E45                469              ADDQ.B  #1,(SCRCYCCT)           ; ACTUALIZAR EL CONTADOR DE CICLOS
00005E92  4E73                     470              RTE
00005E94                           471              
00005E94                           472  ; =============================================================================
00005E94                           473  SCRINIT
00005E94                           474  ; INITIALIZE TRAPS IN ADDITION TO THE SCREEN AND FPS.
00005E94                           475  ; INPUT    - NONE
00005E94                           476  ; OUTPUT   - NONE
00005E94                           477  ; MODIFIES - NONE
00005E94                           478  ; -----------------------------------------------------------------------------
00005E94  007C 0700                479              ORI.W   #$0700,SR               ; DESHABILITAR INTERRUPCIONES
00005E98  21FC 00006260 0084       480              MOVE.L  #SCRUPD,($80+SCRTRAP*4) ; TRAP
00005EA0  223C 028001E0            481              MOVE.L  #SCRWIDTH<<16|SCRHEIGH,D1 ; PONEMOS LA RESOLUCIÓN
00005EA6  103C 0021                482              MOVE.B  #33,D0
00005EAA  4E4F                     483              TRAP    #15
00005EAC  7201                     484              MOVE.L  #1,D1                   ; ACTIVAMOS EL MODO VENTANA
00005EAE  4E4F                     485              TRAP    #15
00005EB0  323C FF00                486              MOVE.W  #$FF00,D1               ; VACIAMOS EL BUFFER VISIBLE
00005EB4  103C 000B                487              MOVE.B  #11,D0
00005EB8  4E4F                     488              TRAP    #15
00005EBA  123C 0011                489              MOVE.B  #17,D1                  ; ACTIVACIÓN DOBLE BUFFER
00005EBE  103C 005C                490              MOVE.B  #92,D0
00005EC2  4E4F                     491              TRAP    #15
00005EC4  323C FF00                492              MOVE.W  #$FF00,D1               ; VACIAMOS EL BUFFER ESCONDIDO
00005EC8  103C 000B                493              MOVE.B  #11,D0
00005ECC  4E4F                     494              TRAP    #15
00005ECE  21FC 00005E8A 0064       495              MOVE.L  #SCRISR,($64)       ; 60+SCRIRQ*4) ; EL VECTOR DE EXCEPCIONES
00005ED6  123C 0005                496              MOVE.B  #5,D1                   ; HABILITAMOS EL PROCESAMIENTO DE LAS EXCEPCIONES
00005EDA  103C 0020                497              MOVE.B  #32,D0
00005EDE  4E4F                     498              TRAP    #15
00005EE0                           499              ; HABILITAMOS LAS INTERRUPCIONES "TIMED"
00005EE0  4285                     500             CLR.L D5
00005EE2  4286                     501             CLR.L D6
00005EE4  4284                     502             CLR.L D4
00005EE6  31FC 0001 5E52           503             MOVE.W   #1,(ENFPS)
00005EEC  31FC 0000 5E54           504              MOVE.W   #0,(FPSAN)
00005EF2  3A3C 03E8                505             MOVE.W #1000,D5
00005EF6  383C 0032                506             MOVE.W #FPS,D4
00005EFA  103C 0020                507              MOVE.B  #32,D0
00005EFE  123C 0006                508              MOVE.B  #6,D1
00005F02  143C 0081                509              MOVE.B  #$81,D2
00005F06  8AFC 0032                510              DIVU.W  #FPS, D5         ; Divide D0 por D1 (D0 = cociente y resto)
00005F0A  3C05                     511              MOVE.W D5,D6
00005F0C  2606                     512              MOVE.L D6,D3
00005F0E  4E4F                     513              TRAP    #15
00005F10  4286                     514              CLR.L D6
00005F12  2C05                     515               MOVE.L  D5, D6         ; Copia D0 para extraer el resto
00005F14  0286 000000FF            516              ANDI.L  #$00FF, D6     ; Mascara para obtener el resto (20)
00005F1A  CCFC 03E8                517              MULU.W  #1000, D6      ; Multiplicar el resto por 1000
00005F1E                           518  
00005F1E  8CC4                     519              DIVU.W  D4,D6          ; D4 = parte decimal (2857)
00005F20  31C6 5E48                520              MOVE.W  D6,(ERROR)
00005F24                           521  
00005F24                           522              
00005F24                           523              
00005F24  4238 5E44                524              CLR.B   (SCRINTCT)              ; PREPARAMOS LOS DATOS DE LA INTERRUPCION
00005F28  4238 5E45                525              CLR.B   (SCRCYCCT) 
00005F2C  027C F8FF                526              ANDI.W  #$F8FF,SR               ; ACTIVAMOS LAS INTERRUPCIONES            
00005F30  4E75                     527              RTS
00005F32                           528  
00005F32                           529  ; =============================================================================
00005F32                           530  FPSUPD
00005F32                           531  ; UPDATE THE FPS WITH THE GIVEN PARAMETERS.
00005F32                           532  ; INPUT    - (FPSIN) AND (FPSAC) AND (SCRCRYCCT)
00005F32                           533  ; OUTPUT   - (FPSAN)
00005F32                           534  ; MODIFIES - (FPSAN)
00005F32                           535  ; -----------------------------------------------------------------------------
00005F32  48A7 FE00                536              MOVEM.W D0-D6,-(A7)
00005F36  2638 5E4E                537              MOVE.L (FPSIN),D3               ;CALCULA LA DIFERENCIA
00005F3A  2838 5E4A                538              MOVE.L  (FPSAC),D4
00005F3E  9883                     539              SUB.L   D3,D4
00005F40                           540             
00005F40  B87C 0000                541              CMP.W   #0,D4                   ;MIRAMOS SI ES NEGATIVA O 0
00005F44  6700 0052                542              BEQ     .FF
00005F48  B87C 0000                543              CMP.W   #0,D4
00005F4C  6C00 0004                544              BGE     .ND
00005F50  4484                     545              NEG.L D4                        ;NEGAMOS PARA CALCULAR EL MODULO
00005F52                           546  .ND
00005F52                           547  
00005F52  C9FC 000A                548              MULS    #10, D4                 ;CONVERSIÓN A MS                 
00005F56  4286                     549              CLR.L D6
00005F58  4285                     550              CLR.L D5
00005F5A  1C38 5E45                551              MOVE.B  (SCRCYCCT),D6           ;DIVIDIMOS POR EL NÚMERO DE CICLOS
00005F5E  9886                     552  .AA         SUB.L   D6,D4                   ;PARA OBTENER LA MEDIA
00005F60  B8BC 00000000            553              CMP.L   #0,D4
00005F66  6D00 0006                554              BLT     .TN
00005F6A  5245                     555              ADDQ.W  #1,D5
00005F6C  60F0                     556              BRA .AA
00005F6E  4283                     557  .TN         CLR.L D3
00005F70  4284                     558              CLR.L D4
00005F72  BA7C 0000                559              CMP.W   #0,D5                   ;MIRAMOS SI ES 0
00005F76  6700 0020                560              BEQ     .FF
00005F7A  263C 000003E8            561              MOVE.L  #1000,D3
00005F80  9685                     562  .CA         SUB.L     D5,D3                 ;1000/TIME(ms)
00005F82  B6BC 00000000            563              CMP.L   #0,D3
00005F88  6D00 0006                564              BLT     .SN
00005F8C  5244                     565              ADDQ.W  #1,D4
00005F8E  60F0                     566              BRA .CA
00005F90                           567  .SN         
00005F90                           568                  
00005F90                           569              
00005F90  31C4 5E54                570              MOVE.W  D4,(FPSAN)              ;GUARDAMOS EL RESULTADO PARA USARLO DESPUÉS
00005F94                           571         
00005F94                           572       
00005F94  6000 0008                573              BRA .TRAP
00005F98  31FC 0064 5E54           574  .FF         MOVE.W #100,(FPSAN)             ;SIGNIFICA QUE ES MENOR A 1*10^-2 s  
00005F9E                           575  .TRAP                                       ;POR LO TANTO, MÁS DE 100 FPS
00005F9E                           576  
00005F9E  4C9F 007F                577              MOVEM.W (A7)+,D0-D6
00005FA2  4E75                     578              RTS 
00005FA4                           579              
00005FA4                           580  
00005FA4                           581  ; =============================================================================
00005FA4                           582  SCRPLOT
00005FA4                           583  ; TRAP SERVICE ROUTINE IN CHARGE OF VISUALIZING CURRENT FRAME AND CLEARING
00005FA4                           584  ; BUFFER FOR THE NEXT ONE.
00005FA4                           585  ; INPUT    - NONE
00005FA4                           586  ; OUTPUT   - NONE
00005FA4                           587  ; MODIFIES - NONE
00005FA4                           588  ; -----------------------------------------------------------------------------            
00005FA4  48E7 FF00                589              MOVEM.L D0-D7,-(A7)
00005FA8                           590              
00005FA8  223C 00FF0000            591              MOVE.L #$00FF0000,D1
00005FAE  303C 0051                592              MOVE.W #81,D0        ; SET FILL COLOR
00005FB2  4E4F                     593              TRAP #15
00005FB4                           594              
00005FB4  43F8 2C04                595              LEA TIMER,A1
00005FB8  4281                     596              CLR.L D1
00005FBA  4280                     597              CLR.L D0
00005FBC  3838 5E66                598              MOVE.W (VTIMER),D4
00005FC0  3238 5E66                599              MOVE.W (VTIMER),D1
00005FC4  103C 0011                600              MOVE.B #17,D0
00005FC8  4E4F                     601              TRAP #15 ;VISUALIZACIÓN DEL TIMER
00005FCA                           602              
00005FCA                           603               ;DEBAJO HACEMOS LA VISUALIZACION DE LOS FPS
00005FCA  43F8 2C24                604              LEA TXTFPS,A1
00005FCE  4281                     605              CLR.L D1
00005FD0                           606              
00005FD0  323C 0032                607              MOVE.W #FPS,D1
00005FD4  103C 0011                608              MOVE.B #17,D0
00005FD8  4E4F                     609              TRAP #15
00005FDA                           610              
00005FDA  43F8 2C60                611               LEA TXT2FPS,A1
00005FDE  4281                     612              CLR.L D1
00005FE0  3238 5E54                613              MOVE.W (FPSAN),D1
00005FE4  103C 0011                614              MOVE.B #17,D0
00005FE8  4E4F                     615              TRAP #15
00005FEA                           616  
00005FEA                           617  
00005FEA                           618              
00005FEA  223C 00FFFFFF            619              MOVE.L #$00FFFFFF,D1
00005FF0  303C 0050                620              MOVE.W #80,D0        ; SET PEN COLOR
00005FF4  4E4F                     621              TRAP #15
00005FF6                           622              
00005FF6  43F8 2C0C                623              LEA SHIELD,A1
00005FFA                           624              
00005FFA  103C 000E                625              MOVE.B #14,D0
00005FFE  4E4F                     626              TRAP #15
00006000                           627              ;Si en D3 hay un 0, indicamos que hay que dibujar el 
00006000                           628              ;rectangulo del escudo, es 1 será el del teleport.
00006000  7600                     629              MOVE.L #0,D3
00006002  3A38 5E78                630              MOVE.W (SHIELDTIMEEN),D5
00006006  B845                     631              CMP D5,D4
00006008                           632              ;Si VTIMER es mayor a SHIELDTIMEEN, se pueden dar dos casos,
00006008                           633              ; que VTIMER sea menor al COOLDOWN, lo que significa que debemos
00006008                           634              ;dibujar rojo o, que VTIMER sea mayor al COOLDOWN lo que indicará
00006008                           635              ;que debemos dibujar verde. 
00006008  6E00 0024                636              BGT .POSIBLEROJO
0000600C                           637              
0000600C  B845                     638              CMP D5,D4
0000600E  6700 00A0                639              BEQ .ROJO
00006012  6000 0002                640              BRA .VERDE
00006016                           641              
00006016                           642              
00006016                           643             
00006016                           644              
00006016                           645         
00006016                           646              
00006016                           647  .VERDE           
00006016                           648              
00006016  223C 0000FF00            649              MOVE.L #$0000FF00,D1
0000601C  303C 0051                650              MOVE.W #81,D0        ; SET FILL COLOR
00006020  4E4F                     651              TRAP #15
00006022                           652              ;Diferenciamos del TP y SHIELD
00006022  B67C 0000                653              CMP #0,D3
00006026  6700 0014                654              BEQ .CHECKPOINT
0000602A  6000 005C                655              BRA .CHECKPOINT2
0000602E                           656  
0000602E                           657              
0000602E                           658  .POSIBLEROJO
0000602E  7600                     659              MOVE.L #0,D3
00006030  3A38 5E7A                660              MOVE.W (SHIELDCOOLDOWN),D5
00006034  BA44                     661              CMP D4,D5
00006036  6E00 0078                662              BGT .ROJO
0000603A                           663              ;Si VTIMER es mayor a COOLDOWN dibujaremos VERDE.
0000603A  60DA                     664              BRA .VERDE
0000603C                           665              
0000603C                           666  .CHECKPOINT
0000603C                           667              ;Dibujado del rectángulo de SHIELD
0000603C  323C 0041                668              MOVE.W #65,D1
00006040  343C 000F                669              MOVE.W #15,D2
00006044  363C 0050                670              MOVE.W #80,D3
00006048  383C 001E                671              MOVE.W #30,D4
0000604C  303C 0057                672              MOVE.W #87,D0
00006050  4E4F                     673              TRAP #15
00006052                           674              
00006052                           675              
00006052  223C 00FF0000            676              MOVE.L #$00FF0000,D1
00006058  303C 0051                677              MOVE.W #81,D0        ; SET FILL COLOR
0000605C  4E4F                     678              TRAP #15
0000605E                           679              
0000605E                           680              
0000605E                           681              ;VISUALIZACIÓN DEL TEXTO DEL TP
0000605E  43F8 2C17                682              LEA TELEPORT,A1
00006062                           683              
00006062  103C 000E                684              MOVE.B #14,D0
00006066  4E4F                     685              TRAP #15
00006068                           686              
00006068  4282                     687              CLR.L D2
0000606A                           688              
0000606A                           689              
0000606A  223C 0000FF00            690              MOVE.L #$0000FF00,D1
00006070  303C 0051                691              MOVE.W #81,D0        ; SET FILL COLOR
00006074  4E4F                     692              TRAP #15
00006076                           693              
00006076                           694              ;SI TIMEENABLE>=VTIMER, entonces dibujaremos ROJO
00006076                           695              ;sino VERDE
00006076  7601                     696              MOVE.L #1,D3
00006078  3838 5E66                697              MOVE.W (VTIMER),D4
0000607C  3A38 5E74                698              MOVE.W (TIMEENABLE),D5
00006080  BA44                     699              CMP D4,D5
00006082  6C00 002C                700              BGE .ROJO
00006086  608E                     701              BRA .VERDE
00006088                           702              
00006088                           703  .CHECKPOINT2
00006088                           704              ;DIBUJADO DEL RECTANGULO
00006088  323C 004B                705              MOVE.W #75,D1
0000608C  343C 001E                706              MOVE.W #30,D2
00006090  363C 005A                707              MOVE.W #90,D3
00006094  383C 002D                708              MOVE.W #45,D4
00006098  303C 0057                709              MOVE.W #87,D0
0000609C  4E4F                     710              TRAP #15
0000609E                           711             
0000609E                           712             
0000609E                           713              
0000609E  223C 00FF0000            714              MOVE.L #$00FF0000,D1
000060A4  303C 0051                715              MOVE.W #81,D0        ; SET FILL COLOR
000060A8  4E4F                     716              TRAP #15
000060AA                           717            
000060AA                           718              
000060AA                           719              
000060AA                           720  
000060AA                           721              
000060AA  4CDF 00FF                722              MOVEM.L (A7)+,D0-D7
000060AE  4E75                     723              RTS
000060B0                           724  
000060B0                           725  
000060B0                           726  .ROJO
000060B0                           727  
000060B0  223C 000000FF            728              MOVE.L #$000000FF,D1
000060B6  303C 0051                729              MOVE.W #81,D0        ; SET FILL COLOR
000060BA  4E4F                     730              TRAP #15
000060BC                           731              
000060BC  B67C 0000                732              CMP #0,D3
000060C0  6700 FF7A                733              BEQ .CHECKPOINT
000060C4  60C2                     734              BRA .CHECKPOINT2
000060C6                           735              
000060C6                           736  ; =============================================================================
000060C6                           737  KBDINIT     
000060C6                           738  ; INITIALIZES THE SYSTEM VARIABLES KBDSYS AND KBDVAL
000060C6                           739  ; INPUT    - NONE
000060C6                           740  ; OUTPUT   - NONE
000060C6                           741  ; MODIFIES - NONE
000060C6                           742  ; -----------------------------------------------------------------------------
000060C6  4238 5E5A                743              CLR.B   (KBDVAL)                    ; INICIALIZAR VARIABLES
000060CA  4238 5E5B                744              CLR.B   (KBDEDGE)
000060CE  4278 5E76                745               CLR (SHIELDENA)
000060D2                           746              
000060D2  4278 5E7C                747             CLR (SHIELDINICIO)
000060D6  21FC 000060E0 0080       748              MOVE.L  #KBDREAD, ($80+KBDTRAP*4)    ; INSTALACIÓN DEL TRAP
000060DE  4E75                     749              RTS
000060E0                           750              
000060E0                           751  ; =============================================================================
000060E0                           752  KBDREAD
000060E0                           753  ; TRAP SERVICE ROUTINE.
000060E0                           754  ; UPDATES THE SYSTEM VARIABLES KBDEDGE AND KBDVAL ACCORDING TO THE BITFIELD
000060E0                           755  ; DESCRIBED IN SYSCONST. KBDVAL HOLDS THE CURRENT VALUES AND KBDEFGE HOLDS
000060E0                           756  ; RISING EDGES FROM PREVIOUS CALL TO THE CURRENT ONE.
000060E0                           757  ; INPUT    - NONE
000060E0                           758  ; OUTPUT   - (KBDVAL) AND (KBDEDGE)
000060E0                           759  ; MODIFIES - NONE
000060E0                           760  ; -----------------------------------------------------------------------------
000060E0  48E7 FF00                761              MOVEM.L D0-D7,-(A7)
000060E4  103C 0013                762              MOVE.B  #19,D0
000060E8  223C 53445741            763              MOVE.L  #KBDDOWN<<24+KBDRIGHT<<16+KBDUP<<8+KBDLEFT,D1
000060EE  4E4F                     764              TRAP    #15
000060F0  6100 002C                765              BSR     .STORE                  ; ALMACENAMOS LOS VALORES
000060F4  1038 5E5A                766              MOVE.B  (KBDVAL),D0             ; CALCULO DEL "EDGE"
000060F8  4600                     767              NOT.B   D0                      ; EDGE=NOT(PREVIOUS) AND CURRENT.
000060FA  C002                     768              AND.B   D2,D0
000060FC  11C2 5E5A                769              MOVE.B  D2,(KBDVAL)             ; ALMACENAMOS LOS VALORES
00006100  11C0 5E5B                770              MOVE.B  D0,(KBDEDGE)
00006104                           771              
00006104                           772              ;MIRAMOS SI EL ESPACIO ESTÁ SIENDO PRESIONADO
00006104                           773              
00006104  103C 0013                774              MOVE.B  #19,D0
00006108  223C 20000000            775              MOVE.L  #KBDSHIELD<<24,D1
0000610E  4E4F                     776              TRAP #15
00006110  0801 0018                777              BTST #24,D1
00006114                           778  
00006114                           779              
00006114  6600 0016                780              BNE .SHIELDPLOT
00006118                           781  .RETURN
00006118  4CDF 00FF                782              MOVEM.L (A7)+,D0-D7
0000611C  4E73                     783              RTE
0000611E                           784  
0000611E  363C 0003                785  .STORE      MOVE.W  #3,D3                   ; TRANSLATES THE 8-BIT ENCODING
00006122  E189                     786  .LOOP       LSL.L   #8,D1                   ; OF TRAP #15 TASK 19 INTO A 1-BIT
00006124  E312                     787              ROXL.B  #1,D2                   ; PER KEYPRESS ENCODING
00006126  51CB FFFA                788              DBRA.W  D3,.LOOP
0000612A  4E75                     789              RTS
0000612C                           790             
0000612C                           791             
0000612C                           792  
0000612C                           793  
0000612C                           794  
0000612C                           795              
0000612C                           796  
0000612C                           797  .SHIELDPLOT
0000612C                           798              ;A la hora de dibujar el escudo tenemos que tener en cuenta varias cosas:
0000612C                           799              ;1: El escudo se puede activar durante 4 segundos desde la primera activación
0000612C                           800              ;2: Después del periodo de activación hay 4 segundos en los que no se podrá
0000612C                           801              ;utilizar, de manera obligatoria.
0000612C                           802              
0000612C                           803              ;Es necesario conocer el instante del inicio de la activación para guardar
0000612C                           804              ;datos que nos servirán posteriormente
0000612C  3238 5E7C                805              MOVE.W (SHIELDINICIO),D1
00006130  0C78 0000 5E7C           806              CMP #0,(SHIELDINICIO)
00006136  6700 0022                807              BEQ .DIB2 ;para obtener datos iniciales
0000613A                           808              
0000613A                           809              
0000613A                           810              ;Se ha presionado espacio, pero sabemos si podemos dibujar el escudo??
0000613A                           811              ;Si SHIELDENA es 1,entonces ya estaremos en cooldown.
0000613A  0C78 0000 5E76           812              CMP #0,(SHIELDENA) 
00006140  6700 0070                813              BEQ  .CHECKTIMER2
00006144                           814              
00006144                           815              
00006144                           816  .CHECKLIST  
00006144                           817              ;Ahora que sabemos que estamos en COOLDOWN, verificamos cuando
00006144                           818              ;se acaba todo para reiniciar las variables necesarias         
00006144  3638 5E66                819              MOVE.W (VTIMER),D3
00006148  3838 5E7A                820              MOVE.W (SHIELDCOOLDOWN),D4
0000614C                           821              
0000614C  9678 5E7A                822              SUB.W (SHIELDCOOLDOWN),D3
00006150                           823  
00006150  B67C 0000                824              CMP #0,D3
00006154                           825              ;Se acabó el cooldown
00006154  6C00 007A                826              BGE .ENABLE            
00006158                           827              
00006158                           828              ;Seguimos en cooldown
00006158  60BE                     829              BRA .RETURN
0000615A                           830  .DIB2
0000615A                           831               
0000615A                           832            
0000615A  3E38 5E66                833              MOVE.W (VTIMER),D7
0000615E  5847                     834              ADD.W #4,D7
00006160  31C7 5E78                835              MOVE.W D7,(SHIELDTIMEEN) ;Periodo en el que se acaba la activación
00006164  5847                     836              ADD.W #4,D7
00006166  31C7 5E7A                837              MOVE.W D7,(SHIELDCOOLDOWN) ;Periodo en el que se acaba el cooldown
0000616A                           838              
0000616A  31FC 0001 5E7C           839              MOVE.W #1,(SHIELDINICIO) ;Hemos empezado la activación
00006170                           840              
00006170  4247                     841              CLR.W D7
00006172                           842              
00006172                           843              
00006172                           844              
00006172                           845  
00006172                           846  
00006172                           847  
00006172                           848  .DIB
00006172                           849  
00006172                           850              ;Dibujado del escudo                  
00006172  4281                     851              CLR.L D1
00006174  223C 0000FF00            852              MOVE.L #$0000FF00,D1
0000617A  303C 0050                853              MOVE.W #80,D0        ; SET PEN COLOR
0000617E  4E4F                     854              TRAP #15
00006180  3A38 5E5C                855              MOVE.W (PLRPOSX),D5
00006184  3C38 5E5E                856              MOVE.W (PLRPOSY),D6
00006188  0645 000F                857              ADD.W #15,D5 
0000618C  0646 000F                858              ADD.W #15,D6
00006190                           859              
00006190                           860           
00006190  0445 001E                861              SUB.W #30,D5
00006194  3205                     862              MOVE.W D5,D1
00006196                           863    
00006196  0645 003C                864              ADD.W #60,D5
0000619A  3605                     865              MOVE.W D5,D3
0000619C                           866              
0000619C  0446 001E                867              SUB.W #30,D6
000061A0  3406                     868              MOVE.W D6,D2
000061A2  0646 003C                869              ADD.W #60,D6
000061A6                           870              
000061A6  3806                     871              MOVE.W D6,D4
000061A8  303C 005B                872              MOVE.W #91,D0
000061AC  4E4F                     873              TRAP #15
000061AE                           874              
000061AE                           875              
000061AE  6000 FF68                876              BRA .RETURN
000061B2                           877  
000061B2                           878  .CHECKTIMER2:
000061B2                           879              ;Miramos si estamos en el periodo de activación
000061B2  3838 5E78                880              MOVE.W (SHIELDTIMEEN),D4
000061B6  3638 5E66                881              MOVE.W (VTIMER),D3
000061BA                           882              
000061BA  9843                     883              SUB.W D3,D4
000061BC                           884             
000061BC  B87C 0000                885              CMP  #0,D4
000061C0  6F00 0004                886              BLE .FIN1
000061C4                           887              
000061C4                           888             
000061C4                           889              
000061C4                           890              ;Si no estamos en cooldown, dibujaremos el escudo.
000061C4  60AC                     891              BRA .DIB
000061C6                           892              
000061C6                           893  
000061C6                           894  .FIN1:
000061C6                           895              ;Estamos en cooldown         
000061C6  31FC 0001 5E76           896              MOVE.W #1,(SHIELDENA)
000061CC  6000 FF4A                897              BRA .RETURN
000061D0                           898  
000061D0                           899  
000061D0                           900  .ENABLE:
000061D0                           901              ;Reinicio de vars
000061D0  4278 5E7C                902              CLR.W (SHIELDINICIO)
000061D4  4278 5E76                903              CLR.W (SHIELDENA)
000061D8  6000 FF3E                904              BRA .RETURN
000061DC                           905                                    
000061DC                           906  ; =============================================================================           
000061DC                           907  MOUSEINIT     
000061DC                           908  ; INITIALIZES THE SYSTEM VARIABLES MOUSEPOSX AND MOUSEPOSY AND ENATP AND LASTENA
000061DC                           909  ; INPUT    - NONE
000061DC                           910  ; OUTPUT   - NONE
000061DC                           911  ; MODIFIES - NONE
000061DC                           912  ; -----------------------------------------------------------------------------
000061DC  4278 5E70                913              CLR.W   (MOUSEPOSX)                    ;INICIALIZAR VARS
000061E0  4278 5E72                914              CLR.W   (MOUSEPOSY)
000061E4  4278 5E6C                915              CLR.W   (ENATP)
000061E8  4278 5E6E                916              CLR.W   (LASTENA)
000061EC                           917              
000061EC  21FC 000061F6 0088       918              MOVE.L  #REVISION, ($80+MOUSETRAP*4)    ; INSTALAR
000061F4  4E75                     919              RTS
000061F6                           920              
000061F6                           921  ; =============================================================================            
000061F6                           922  REVISION:
000061F6                           923  ; TRAP SERVICE ROUTINE HANDLES THE USE OF THE MOUSE.
000061F6                           924  ; INPUT    - NONE
000061F6                           925  ; OUTPUT   - NONE
000061F6                           926  ; MODIFIES - NONE
000061F6                           927  ; -----------------------------------------------------------------------------
000061F6  48E7 FF00                928              MOVEM.L D0-D7,-(A7)
000061FA                           929  
000061FA                           930              ; LECTURA DEL ESTADO ACTUAL DEL RATÓN
000061FA  103C 003D                931              MOVE.B  #61,D0
000061FE  123C 0000                932              MOVE.B  #00,D1
00006202                           933              
00006202  4E4F                     934              TRAP    #15
00006204  31C1 5E70                935              MOVE.W  D1,(MOUSEPOSX)
00006208                           936              
00006208                           937  
00006208                           938              
00006208                           939              
00006208                           940  
00006208  4841                     941              SWAP    D1            ; Intercambia los 16 bits superiores e inferiores de D1
0000620A                           942  
0000620A  31C1 5E72                943              MOVE.W  D1,(MOUSEPOSY)
0000620E  4841                     944              SWAP    D1
00006210                           945              
00006210                           946  
00006210                           947              ; DETECTAMOS SI SE HA PRESIONADO CLICK
00006210  0800 0000                948              BTST    #0,D0
00006214                           949              
00006214  6700 0044                950              BEQ     NOT_PRESSED
00006218                           951              ;SE HA PRESIONADO, PERO ESTAMOS EN COOLDOWN???
00006218                           952              ;Si ENATP es 0, haremos el TP
00006218  0C78 0000 5E6C           953              CMP.W   #0,(ENATP)
0000621E  6600 0028                954              BNE CHECKTIMER
00006222                           955  
00006222                           956  PRESSED:
00006222                           957  
00006222                           958              ;Guardamos la ultima activación
00006222  31F8 5E66 5E6E           959               MOVE.W (VTIMER),(LASTENA)
00006228  3438 5E66                960               MOVE.W (VTIMER),D2
0000622C  5C42                     961               ADD.W #6,D2
0000622E                           962               ;Guardamos cuando podras activarlo de nuevo
0000622E  31C2 5E74                963               MOVE.W D2,(TIMEENABLE)
00006232                           964               ;Se realiza el TP
00006232  31F8 5E70 5E5C           965              MOVE.W (MOUSEPOSX),(PLRPOSX)
00006238  31F8 5E72 5E5E           966              MOVE.W (MOUSEPOSY),(PLRPOSY)
0000623E                           967              ;Estamos en cooldown
0000623E  31FC 0001 5E6C           968              MOVE.W #1,(ENATP)
00006244                           969              
00006244  6000 0014                970              BRA NOT_PRESSED
00006248                           971              
00006248                           972  
00006248                           973  CHECKTIMER:
00006248                           974              ;Verificacion de si salimos del periodo de cooldown
00006248  3838 5E74                975              MOVE.W (TIMEENABLE),D4
0000624C  3638 5E66                976              MOVE.W (VTIMER),D3
00006250                           977              
00006250  B843                     978              CMP D3,D4
00006252  6C00 0006                979              BGE NOT_PRESSED
00006256  4278 5E6C                980              CLR.W (ENATP)
0000625A                           981              
0000625A                           982           
0000625A                           983  NOT_PRESSED:          
0000625A  4CDF 00FF                984              MOVEM.L  (A7)+,D0-D7
0000625E  4E73                     985              RTE
00006260                           986              
00006260                           987             
00006260                           988  ; -----------------------------------------------------------------------------
00006260                           989  SCRUPD
00006260                           990  ; TRAP SERVICE ROUTINE IN CHARGE OF VISUALIZING CURRENT FRAME AND CLEARING
00006260                           991  ; BUFFER FOR THE NEXT ONE AND VISUALIZE THE FPS.
00006260                           992  ; INPUT    - (FPSAN)
00006260                           993  ; OUTPUT   - NONE
00006260                           994  ; MODIFIES - NONE
00006260                           995  ; -----------------------------------------------------------------------------
00006260  48A7 FE40                996              MOVEM.W D0-D6/A1,-(A7)
00006264  4280                     997              CLR.L D0
00006266  4281                     998              CLR.L D1
00006268  103C 005E                999              MOVE.B  #94,D0                  ; ACTUALIZA DOUBLE BUFFER
0000626C  4E4F                    1000              TRAP    #15
0000626E  323C FF00               1001              MOVE.W  #$FF00,D1               ; LIMPIA EL BUFFER ESCONDIDO
00006272  103C 000B               1002              MOVE.B  #11,D0
00006276  4E4F                    1003              TRAP    #15
00006278  4C9F 027F               1004              MOVEM.W (A7)+,D0-D6/A1
0000627C  4E73                    1005              RTE
0000627E                          1006              
0000627E                          1007  ; -----------------------------------------------------------------------------
0000627E                          1008  FILLOAD
0000627E                          1009  ; LOADS AN FILE FROM DISK TO MEMORY
0000627E                          1010  ; INPUT    : A0 - DESTINATION ADDR. WITH ENOUGH SPACE AVAILABLE.
0000627E                          1011  ;            A1 - POINTER TO FILE NAME
0000627E                          1012  ; OUTPUT   : NONE
0000627E                          1013  ; MODIFIES : NONE
0000627E                          1014  ; NOTE     : THE READ DATA LOOP READS 1 BYTE AT A TIME TO ENSURE ALL FILES CAN
0000627E                          1015  ;            BE LOADED. HOWEVER, IF THE FILE SIZE IS KNOWN BEFOREHAND, NO LOOP
0000627E                          1016  ;            WOULD BE NECESSARY AND A SINGLE CALL TO TRAP #15 TASK 53 WOULD READ
0000627E                          1017  ;            THE WHOLE FILE AS LONG AS THE FILE SIZE IS PLACED INTO D2.L.
0000627E                          1018  ; NOTE     : THE ZERO-TERMINATOR (JUST BEFORE CLOSE THE FILE) IS A REQUIREMENT
0000627E                          1019  ;            FOR TEXT-FILES IF THE TEXT IS TO BE PRINTED. FOR OTHER USES, IT
0000627E                          1020  ;            CAN BE REMOVED.
0000627E                          1021  ; ------------------------------------------------------------------------------
0000627E  48E7 E040               1022              MOVEM.L D0-D2/A1,-(A7)          ; SAVE REGISTERS
00006282                          1023              ; CLOSE ALL FILES
00006282  103C 0032               1024              MOVE.B  #50,D0
00006286  4E4F                    1025              TRAP    #15
00006288                          1026              ; OPEN FILE (ASSUMES A1 POINTS TO FILENAME)
00006288  103C 0033               1027              MOVE.B  #51,D0
0000628C  4E4F                    1028              TRAP    #15                     ; D1.L:=FILE HANDLER
0000628E                          1029              ; READ DATA
0000628E  2248                    1030              MOVE.L  A0,A1                   ; A1 MUST BE THE BUFFER ADDRESS
00006290  103C 0035               1031              MOVE.B  #53,D0                  ; READ DATA TASK
00006294  243C 00001000           1032              MOVE.L  #4096,D2                   ; READ ALL THE FILE
0000629A  4E4F                    1033              TRAP    #15
0000629C                          1034                                 ; PUT A ZERO-TERMINATOR.
0000629C                          1035              ; CLOSE THE FILE
0000629C  103C 0038               1036              MOVE.B  #56,D0
000062A0  4E4F                    1037              TRAP    #15
000062A2  4CDF 0207               1038              MOVEM.L (A7)+,D0-D2/A1          ; RESTORE REGISTERS
000062A6  4E75                    1039              RTS
000062A8                          1040  
000062A8                          1041  ; -----------------------------------------------------------------------------
000062A8                          1042  WIN:
000062A8                          1043  ; DETECT THE WINNING CONDITION AND DRAW A MESSAGE WITH A PICTURE
000062A8                          1044  ; INPUT    : NONE
000062A8                          1045  ; OUTPUT   : NONE
000062A8                          1046  ; MODIFIES : NONE
000062A8                          1047  ; ------------------------------------------------------------------------------
000062A8  48E7 FE00               1048              MOVEM.L D0-D6,-(A7)
000062AC  48E7 00FE               1049              MOVEM.L A0-A6,-(A7)
000062B0                          1050              
000062B0  0C78 0050 5E66          1051              CMP #80,(VTIMER)
000062B6  6600 008E               1052              BNE RETURN
000062BA                          1053              ;EL JUEGO HA TERMINADO
000062BA                          1054              ;DESHABILITAMOS DOUBLE BUFFER Y BORRAMOS PANTALLA
000062BA  323C 0010               1055              MOVE.W #16,D1
000062BE  303C 005C               1056              MOVE.W #92,D0
000062C2  4E4F                    1057              TRAP #15
000062C4                          1058              
000062C4                          1059              ;VACIAMOS PANTALLA
000062C4  303C 000B               1060              MOVE.W #11,D0
000062C8  323C FF00               1061              MOVE.W #$FF00,D1
000062CC  4E4F                    1062              TRAP #15
000062CE                          1063              
000062CE                          1064              
000062CE  7200                    1065              MOVE.L #$00000000,D1
000062D0  303C 0051               1066              MOVE.W #81,D0        ; SET FILL COLOR
000062D4  4E4F                    1067              TRAP #15
000062D6                          1068              
000062D6                          1069              
000062D6  223C 000000FF           1070              MOVE.L #$000000FF,D1
000062DC  303C 0050               1071              MOVE.W #80,D0        ; SET PEN COLOR
000062E0  4E4F                    1072              TRAP #15
000062E2                          1073              
000062E2                          1074              ;ESCRIBIMOS LOS MENSAJES CORRESPONDIENTES  
000062E2  43F8 2DA4               1075              LEA WIN1,A1
000062E6                          1076              
000062E6  103C 000E               1077              MOVE.B #14,D0
000062EA  4E4F                    1078              TRAP #15
000062EC                          1079              
000062EC  43F8 2DDB               1080              LEA WIN2,A1
000062F0                          1081              
000062F0  103C 000E               1082              MOVE.B #14,D0
000062F4  4E4F                    1083              TRAP #15
000062F6                          1084  
000062F6                          1085              
000062F6                          1086  .DIBUJAR    ;DIBUJAR IMAGEN FINAL
000062F6  383C 0400               1087              MOVE.W #1024,D4
000062FA  5344                    1088              SUBQ.W #1,D4
000062FC  41F8 3E20               1089              LEA WINPIX,A0
00006300  43F8 4E32               1090              LEA FILENAMEWIN,A1
00006304  4EB8 627E               1091              JSR FILLOAD
00006308                          1092              
00006308  47F8 4E44               1093              LEA X1,A3
0000630C  49F8 5644               1094              LEA Y1,A4
00006310                          1095             
00006310                          1096  LOOPDIB1:
00006310  4281                    1097              CLR.L D1
00006312  4282                    1098              CLR.L D2
00006314  103C 0050               1099              MOVE.B #80,D0
00006318  2218                    1100              MOVE.L (A0)+,D1
0000631A  4E4F                    1101              TRAP #15 ;PEN COLOR
0000631C  103C 0052               1102              MOVE.B #82,D0
00006320  4281                    1103              CLR.L D1
00006322  4282                    1104              CLR.L D2
00006324  321B                    1105              MOVE.W (A3)+,D1
00006326  341C                    1106              MOVE.W (A4)+,D2
00006328  0681 0000012C           1107              ADD.L #DSPLZ1,D1
0000632E  0682 0000006E           1108              ADD.L #DSPLZ2,D2
00006334                          1109              
00006334  4E4F                    1110              TRAP #15 ;Dibujar pixel
00006336  51CC FFD8               1111              DBRA D4,LOOPDIB1
0000633A                          1112             
0000633A                          1113              
0000633A  4CDF 7F00               1114              MOVEM.L (A7)+,A0-A6
0000633E  4CDF 007F               1115              MOVEM.L (A7)+,D0-D6
00006342  FFFF FFFF               1116              SIMHALT
00006346                          1117  
00006346                          1118              
00006346                          1119  
00006346                          1120  
00006346                          1121              
00006346                          1122  RETURN
00006346  4CDF 7F00               1123              MOVEM.L (A7)+,A0-A6
0000634A  4CDF 007F               1124              MOVEM.L (A7)+,D0-D6
0000634E  4E75                    1125              RTS
00006350                          1126             
00006350                          1127  
00006350                          1128  
00006350                          1129  
00006350                          1130  
00006350                          1131  
00006350                          1132  
00006350                          1133  
00006350                          1134  
00006350                          1135  
00006350                          1136  
00006350                          1137  
00006350                          1138  
00006350                          1139  -------------------- end include --------------------
00006350                          1140               INCLUDE "PLY.X68"
00006350                          1141  ; -----------------------------------------------------------------------------
00006350                          1142  PLRINIT            
00006350                          1143  ; INIT THE POSITION OF THE PLAYER
00006350                          1144  ; INPUT    - NONE (ACCESSES KBDVAL AND KBDEDGE)
00006350                          1145  ; OUTPUT   - NONE (MODIFIES PLAYER DATA)
00006350                          1146  ; MODIFIES - NONE
00006350                          1147  ;----------------------------------------------------------------------------           
00006350  31FC 0002 5E64          1148              MOVE.W #GRAVEDAD,(VGRAVEDAD)
00006356  31FC 0140 5E5C          1149              MOVE.W  #(SCRWIDTH)/2,(PLRPOSX)
0000635C  31FC 01C2 5E5E          1150              MOVE.W  #(SCRHEIGH-PLRHEIGH),(PLRPOSY)
00006362  4E75                    1151              RTS
00006364                          1152              
00006364                          1153  ; -----------------------------------------------------------------------------            
00006364                          1154  PLRUPD
00006364                          1155  ; UPDATES THE PLAYER MOTION
00006364                          1156  ; INPUT    - NONE (ACCESSES KBDVAL AND KBDEDGE)
00006364                          1157  ; OUTPUT   - NONE (MODIFIES PLAYER DATA)
00006364                          1158  ; MODIFIES - NONE
00006364                          1159  ; -----------------------------------------------------------------------------
00006364  48A7 7010               1160              MOVEM.W  D1/A3/D2/D3,-(A7)
00006368                          1161              
00006368                          1162              
00006368  1238 5E5A               1163              MOVE.B  (KBDVAL),D1             ; HACER EL MOVIMIENTO Y MIRAR LOS BORDES
0000636C  47F8 5E64               1164              LEA     VGRAVEDAD,A3
00006370  3438 5E5E               1165              MOVE.W   (PLRPOSY),D2
00006374  D453                    1166              ADD.W   (A3),D2                         ;AÑADIMOS GRAVEDAD
00006376  31C2 5E5E               1167              MOVE.W  D2,(PLRPOSY)
0000637A                          1168             
0000637A  E219                    1169              ROR.B   #1,D1
0000637C  6400 0012               1170              BCC     .CHKUP
00006380  5D78 5E5C               1171              SUB.W   #PLRSPEEDX,(PLRPOSX)
00006384  4A78 5E5C               1172              TST.W   (PLRPOSX)
00006388  6C00 0006               1173              BGE     .CHKUP
0000638C  4278 5E5C               1174              CLR.W   (PLRPOSX)
00006390  E219                    1175  .CHKUP      ROR.B   #1,D1
00006392  6400 0018               1176              BCC     .CHKRT
00006396                          1177              
00006396  0478 0014 5E5E          1178              SUB.W   #PLRSPEEDY,(PLRPOSY) 
0000639C  5278 5E64               1179              ADDQ.W  #1,(VGRAVEDAD)    ;INCREMENTAMOS LA GRAVEDAD PARA QUE HAYA
000063A0                          1180                                        ;UN MOMENTO DONDE SEA MAYOR A LA VELY
000063A0  4A78 5E5E               1181              TST.W   (PLRPOSY)
000063A4  6C00 0006               1182              BGE     .CHKRT
000063A8  4278 5E5E               1183              CLR.W   (PLRPOSY)
000063AC  E219                    1184  .CHKRT      ROR.B   #1,D1
000063AE  6400 0016               1185              BCC     .CHKDN
000063B2  5C78 5E5C               1186              ADD.W   #PLRSPEEDX,(PLRPOSX)
000063B6  0C78 0262 5E5C          1187              CMP.W   #SCRWIDTH-PLRWIDTH,(PLRPOSX)
000063BC  6F00 0008               1188              BLE     .CHKDN
000063C0  31FC 0262 5E5C          1189              MOVE.W  #SCRWIDTH-PLRWIDTH,(PLRPOSX)
000063C6  E219                    1190  .CHKDN      ROR.B   #1,D1
000063C8  6400 000C               1191              BCC     .MDONE
000063CC  0678 0014 5E5E          1192              ADD.W   #PLRSPEEDY,(PLRPOSY)
000063D2                          1193             
000063D2  6000 0002               1194              BRA     .MDONE
000063D6                          1195             
000063D6                          1196  .MDONE      
000063D6  0C78 01C2 5E5E          1197              CMP.W   #SCRHEIGH-PLRHEIGH,(PLRPOSY)
000063DC  6F00 000E               1198              BLE     .FINAL
000063E0  31FC 01C2 5E5E          1199              MOVE.W  #SCRHEIGH-PLRHEIGH,(PLRPOSY)
000063E6  31FC 0002 5E64          1200              MOVE.W #GRAVEDAD,(VGRAVEDAD)            ;CUANDO TOCAMOS SUELO DEJAMOS
000063EC                          1201                                              ;LA GRAVEDAD COMO CONSTANTE ANTERIOR
000063EC                          1202              
000063EC                          1203              
000063EC  4C9F 080E               1204  .FINAL      MOVEM.W  (A7)+,D1/A3/D2/D3
000063F0  4E75                    1205              RTS
000063F2                          1206  ; -----------------------------------------------------------------------------            
000063F2                          1207  DIBUJAR     
000063F2                          1208  ; DRAW THE CHARACTER IMAGE
000063F2                          1209  ; INPUT    - X AND Y
000063F2                          1210  ; OUTPUT   - NONE 
000063F2                          1211  ; MODIFIES - NONE
000063F2                          1212  ; -----------------------------------------------------------------------------
000063F2                          1213              ;Dibujaremos un numero constante de pixeles, contados por el programa
000063F2                          1214              ;que escribe los RGB en un documento en binario, usaremos FILLOAD, para
000063F2                          1215              ;tener los RGB en memoria, además de utilizar unas variables llamadas X e Y
000063F2                          1216              ;que indican las coordenadas de cada pixel. Cada pixel lo moveremos segun 
000063F2                          1217              ;PLRPOSX y PLRPOSY
000063F2                          1218  
000063F2  48E7 FE00               1219              MOVEM.L D0-D6,-(A7)
000063F6  48E7 00FE               1220              MOVEM.L A0-A6,-(A7)
000063FA                          1221              
000063FA  3A38 5E5C               1222              MOVE.W (PLRPOSX),D5
000063FE  3C38 5E5E               1223              MOVE.W (PLRPOSY),D6
00006402                          1224              ;CARGAMOS LOS DATOS
00006402  41F8 2E20               1225              LEA PIXEL,A0
00006406  43F8 4E20               1226              LEA FILENAMEPIX,A1
0000640A  4EB8 627E               1227              JSR FILLOAD
0000640E                          1228              
0000640E  47F8 1000               1229              LEA X,A3
00006412  49F8 1E00               1230              LEA Y,A4            
00006416                          1231             
00006416  3A38 5E5C               1232              MOVE.W (PLRPOSX),D5
0000641A  3C38 5E5E               1233              MOVE.W (PLRPOSY),D6
0000641E                          1234              
0000641E  383C 0380               1235              MOVE.W #896,D4
00006422  5344                    1236              SUBQ.W #1,D4
00006424                          1237              
00006424                          1238              
00006424                          1239              
00006424                          1240  LOOPDIB:
00006424                          1241              
00006424  103C 0050               1242              MOVE.B #80,D0
00006428  2218                    1243              MOVE.L (A0)+,D1
0000642A  4E4F                    1244              TRAP #15 ;PEN COLOR
0000642C  103C 0052               1245              MOVE.B #82,D0
00006430  4281                    1246              CLR.L D1
00006432  221B                    1247              MOVE.L (A3)+,D1
00006434  241C                    1248              MOVE.L (A4)+,D2
00006436  D285                    1249              ADD.L D5,D1
00006438  D486                    1250              ADD.L D6,D2
0000643A                          1251              
0000643A  4E4F                    1252              TRAP #15 ;Dibujar pixel
0000643C  51CC FFE6               1253              DBRA D4,LOOPDIB
00006440                          1254             ; JSR BALPLOT
00006440                          1255              
00006440  4CDF 7F00               1256              MOVEM.L (A7)+,A0-A6
00006444  4CDF 007F               1257              MOVEM.L (A7)+,D0-D6
00006448  4E75                    1258              RTS
0000644A                          1259              
0000644A                          1260  
0000644A                          1261  
0000644A                          1262  
0000644A                          1263  
0000644A                          1264  
0000644A                          1265  -------------------- end include --------------------
0000644A                          1266               INCLUDE "BALL.X68"
0000644A                          1267  ; ==============================================================================
0000644A                          1268  ; BALL MANAGEMENT (AGENT)
0000644A                          1269  ; BALPOSX (W)  (A0)
0000644A                          1270  ; BALPOSY (W) 2(A0)
0000644A                          1271  ; BALVELX (W) 4(A0)
0000644A                          1272  ; BALVELY (W) 6(A0)
0000644A                          1273  ; ==============================================================================
0000644A                          1274              
0000644A                          1275  ; ------------------------------------------------------------------------------
0000644A                          1276  BALINIT
0000644A                          1277  ; INITIALIZE BALL.
0000644A                          1278  ; INPUT    : A0 POINTER TO THE INSTANCE VARIABLES 
0000644A                          1279  ; OUTPUT   : NONE
0000644A                          1280  ; MODIFIES : NONE
0000644A                          1281  ; ------------------------------------------------------------------------------
0000644A  48E7 FFE0               1282              MOVEM.L D0-A2,-(A7),-(A7)
0000644E  4242                    1283              CLR D2
00006450  4EB9 000074D2           1284              JSR     UTLRAND
00006456  43F9 00006496           1285              LEA     .VELVEC,A1
0000645C  45F9 000064A6           1286              LEA     .POSVEC,A2
00006462  C0BC 0000000C           1287              AND.L   #$0000000C,D0           ;MASCARA PARA TENER DE 0-12           
00006468  20B2 0000               1288              MOVE.L  (A2,D0),(A0)
0000646C                          1289              
0000646C                          1290              
0000646C  3200                    1291              MOVE.W D0,D1  
0000646E  4280                    1292              CLR.L D0
00006470  4EB9 000074D2           1293              JSR     UTLRAND
00006476  0800 0000               1294              BTST #0, D0        ;OTRO RANDOM PARA CONSEGUIR LAS VELOCIDADES
0000647A  6600 000E               1295              BNE .BitIsClear    ;SI ES 0 SE VA A LA SIGUIENTE VELOCIDADES  
0000647E  3401                    1296              MOVE.W D1,D2
00006480  B47C 000C               1297              CMP #12,D2        ;SI ES EL ULTIMO SE QUEDA CON ESE
00006484  6700 0004               1298              BEQ .BitIsClear
00006488  5841                    1299              ADDQ.W #4,D1      
0000648A                          1300              
0000648A                          1301  .BitIsClear  
0000648A                          1302              
0000648A  2171 1000 0004          1303              MOVE.L  (A1,D1),4(A0)
00006490                          1304              
00006490                          1305              
00006490  4CDF 07FF               1306              MOVEM.L (A7)+,D0-A2
00006494                          1307  
00006494  4E75                    1308              RTS
00006496                          1309  
00006496= 0003 FFFD               1310  .VELVEC     DC.W    BALVEL,-BALVEL      ;0
0000649A= 0003 0003               1311              DC.W    BALVEL,BALVEL       ;4
0000649E= FFFD FFFD               1312              DC.W    -BALVEL,-BALVEL     ;8
000064A2= FFFD 0003               1313              DC.W    -BALVEL,BALVEL          ;12
000064A6= 0000 00A0               1314  .POSVEC     DC.W    0,160     ;0
000064AA= 0000 0140               1315              DC.W    0,320       ;4
000064AE= 0280 00A0               1316              DC.W    SCRWIDTH,160      ;8
000064B2= 0280 0140               1317              DC.W    SCRWIDTH,320       ;12
000064B6                          1318  
000064B6                          1319              
000064B6                          1320  ; ------------------------------------------------------------------------------
000064B6                          1321  BALUPD
000064B6                          1322  ; UPDATES THE BALL.
000064B6                          1323  ; INPUT    : A0 POINTER TO THE INSTANCE VARIABLES  
000064B6                          1324  ; OUTPUT   : NONE
000064B6                          1325  ; MODIFIES : NONE
000064B6                          1326  ; ------------------------------------------------------------------------------
000064B6                          1327  
000064B6  48A7 FF00               1328              MOVEM.W D0-D7,-(A7)
000064BA                          1329              
000064BA                          1330              ; ACTUALIZACIÓN DE COORDENADAS 
000064BA  3010                    1331              MOVE.W  (A0),D0
000064BC  3228 0002               1332              MOVE.W  2(A0),D1
000064C0                          1333              
000064C0  D068 0004               1334              ADD.W   4(A0),D0
000064C4  D268 0006               1335              ADD.W   6(A0),D1
000064C8                          1336              
000064C8                          1337              
000064C8                          1338            ; REVISAMOS LAS COLISIONES HORIZONTALES
000064C8  B07C 026C               1339              CMP.W   #SCRWIDTH-BALRAD,D0
000064CC  6E00 001E               1340              BGT     .COLRGT
000064D0  B07C 0014               1341              CMP.W   #BALRAD,D0
000064D4  6D00 0020               1342              BLT     .COLLFT
000064D8                          1343              
000064D8                          1344              ; REVISAMOS LAS COLISIONES VERTICALES
000064D8  B27C 01CC               1345  .CHKVERT    CMP.W   #SCRHEIGH-BALRAD,D1
000064DC  6E00 0022               1346              BGT     .COLBOT
000064E0  B27C 0014               1347              CMP.W   #BALRAD,D1
000064E4  6D00 0026               1348              BLT     .COLTOP
000064E8  6000 002E               1349              BRA     .SHIELDCOLISION
000064EC                          1350              
000064EC                          1351              ; REVISAMOS LAS COLISIONES EN LA DERECHA
000064EC  4468 0004               1352  .COLRGT     NEG.W   4(A0)
000064F0  303C 026C               1353              MOVE.W  #SCRWIDTH-BALRAD,D0
000064F4  60E2                    1354              BRA     .CHKVERT
000064F6                          1355              
000064F6                          1356              ;REVISAMOS LAS COLISIONES EN LA IZQUIERDA
000064F6  4468 0004               1357  .COLLFT     NEG.W   4(A0)
000064FA  303C 0014               1358              MOVE.W #BALRAD,D0
000064FE  60D8                    1359              BRA     .CHKVERT
00006500                          1360  
00006500                          1361              ; REVISAMOS LAS COLISIONES ABAJO
00006500  4468 0006               1362  .COLBOT     NEG.W   6(A0)
00006504  323C 01CC               1363              MOVE.W  #SCRHEIGH-BALRAD,D1
00006508  6000 000E               1364              BRA     .SHIELDCOLISION
0000650C                          1365              
0000650C                          1366              ; REVISAMOS LAS COLISIONES ARRIBA
0000650C                          1367  
0000650C  4468 0006               1368  .COLTOP      NEG.W   6(A0)
00006510  323C 0014               1369              MOVE.W  #BALRAD,D1
00006514  6000 0002               1370              BRA .SHIELDCOLISION
00006518                          1371              
00006518                          1372  .SHIELDCOLISION
00006518                          1373              
00006518                          1374              ;Miramos primero las colisiones del escudo, pues antes de 
00006518                          1375              ;tocar al jugador, se toca el escudo(si está activo)
00006518  3080                    1376              MOVE.W  D0,(A0)
0000651A  3141 0002               1377              MOVE.W  D1,2(A0)
0000651E                          1378              
0000651E  0440 0014               1379              SUB.W   #BALRAD,D0
00006522  0441 0014               1380              SUB.W   #BALRAD,D1
00006526  31C0 2C00               1381              MOVE.W D0,(BALPRV1)
0000652A  31C1 2C02               1382              MOVE.W D1,(BALPRV2) ;guardar por si despues miramos la del player
0000652E                          1383              
0000652E                          1384              ;MIRAMOS SI EL ESCUDO ESTA ACTIVO, para eso, dos comprobaciones
0000652E                          1385              ;1 (esta el espacio presionado)?
0000652E                          1386              ;2(estamos en el tiempo disponible para la activación del mismo)?
0000652E  103C 0013               1387              MOVE.B  #19,D0
00006532  223C 20000000           1388              MOVE.L  #KBDSHIELD<<24,D1
00006538  4E4F                    1389              TRAP #15
0000653A  0801 0018               1390              BTST #24,D1
0000653E                          1391              
0000653E  6700 0052               1392              BEQ .PLRCOLISION ;No estamos presionando espacio, miramos si
00006542                          1393              ;la bola toca al jugador
00006542                          1394              
00006542                          1395              ;HEMOS PRESIONADO ESPACIO!
00006542  3C38 5E78               1396              MOVE.W (SHIELDTIMEEN),D6
00006546  3E38 5E66               1397              MOVE.W (VTIMER),D7
0000654A  BC47                    1398              CMP D7,D6
0000654C  6F00 0044               1399              BLE .PLRCOLISION                ;NO estamos en el tiempo indicado
00006550                          1400              
00006550  4286                    1401              CLR.L D6
00006552  4287                    1402              CLR.L D7           
00006554                          1403              
00006554                          1404              ;Preparamos los datos para llamar al UTLCHCOL 
00006554  3038 2C00               1405              MOVE.W (BALPRV1),D0
00006558  3238 2C02               1406              MOVE.W (BALPRV2),D1
0000655C  3438 5E5C               1407              MOVE.W (PLRPOSX),D2
00006560  0442 000F               1408              SUB.W #15,D2
00006564                          1409              
00006564  3638 5E5E               1410              MOVE.W (PLRPOSY),D3
00006568  0443 000F               1411              SUB.W #15,D3
0000656C                          1412         
0000656C                          1413              
0000656C  383C 0028               1414              MOVE.W #BALRAD*2,D4
00006570  3A3C 002D               1415              MOVE.W #SHIELDATA,D5
00006574                          1416              
00006574  3C3C 0028               1417              MOVE.W #BALRAD*2,D6
00006578  3E3C 002D               1418              MOVE.W #SHIELDATA,D7
0000657C                          1419              
0000657C  4EB9 000074EA           1420              JSR     UTLCHCOL
00006582  4A00                    1421              TST.B   D0
00006584                          1422              ;Si no hay colisión no hacemos nada
00006584  6700 0096               1423              BEQ     .DONE
00006588                          1424              ;Si hay colisión matamos el agente, es decir
00006588                          1425              ;quitamos la bola tocada por el escudo.
00006588  4EB9 000073A6           1426              JSR     AGLKILL
0000658E  6000 008C               1427              BRA .DONE
00006592                          1428              
00006592                          1429              
00006592                          1430              
00006592                          1431  
00006592                          1432  
00006592                          1433  .PLRCOLISION
00006592                          1434             
00006592                          1435              
00006592                          1436              ;Teniamos guardadas X e Y
00006592                          1437              ; en BALPRV1 y BALPRV2
00006592  3038 2C00               1438              MOVE.W   (BALPRV1),D0
00006596  3238 2C02               1439              MOVE.W   (BALPRV2),D1
0000659A                          1440              
0000659A  3438 5E5C               1441              MOVE.W (PLRPOSX),D2
0000659E  3638 5E5E               1442              MOVE.W (PLRPOSY),D3
000065A2                          1443              
000065A2  383C 0028               1444              MOVE.W #BALRAD*2,D4
000065A6  3A3C 001E               1445              MOVE.W #PLRWIDTH,D5
000065AA                          1446             
000065AA  3C3C 0028               1447              MOVE.W #BALRAD*2,D6
000065AE  3E3C 001E               1448              MOVE.W #PLRHEIGH,D7
000065B2                          1449              
000065B2  4EB9 000074EA           1450              JSR     UTLCHCOL
000065B8  4A00                    1451              TST.B   D0
000065BA  6700 0060               1452              BEQ     .DONE
000065BE                          1453              ;GAME OVER
000065BE                          1454              
000065BE                          1455              ;DESHABILITAMOS EL DOUBLE BUFFER
000065BE                          1456              ;Debemos deshabilitar el double buffer, porque los
000065BE                          1457              ;textos de arriba a la izquierda se quedan aunque borremos
000065BE                          1458              ;la pantalla mediante otro trap 15.
000065BE  323C 0010               1459              MOVE.W #16,D1
000065C2  303C 005C               1460              MOVE.W #92,D0
000065C6  4E4F                    1461              TRAP #15
000065C8                          1462              
000065C8                          1463              ;Limpiar pantalla : Ponemos D1.W a $FF00
000065C8  303C 000B               1464              MOVE.W #11,D0
000065CC  323C FF00               1465              MOVE.W #$FF00,D1
000065D0  4E4F                    1466              TRAP #15
000065D2                          1467              
000065D2                          1468              
000065D2  7200                    1469              MOVE.L #$00000000,D1
000065D4  303C 0051               1470              MOVE.W #81,D0        ; PONEMOS FILL COLOR
000065D8  4E4F                    1471              TRAP #15
000065DA                          1472              
000065DA                          1473              
000065DA  223C 000000FF           1474              MOVE.L #$000000FF,D1
000065E0  303C 0050               1475              MOVE.W #80,D0        ; PONEMOS PEN COLOR
000065E4  4E4F                    1476              TRAP #15
000065E6                          1477  
000065E6                          1478              ;Cargamos los textos indicados
000065E6  43F8 2C6A               1479              LEA GAMEOVER1,A1
000065EA  303C 000E               1480              MOVE.W #14,D0
000065EE  4E4F                    1481              TRAP #15
000065F0                          1482             
000065F0                          1483              
000065F0                          1484              
000065F0                          1485              
000065F0  43F8 2CA3               1486              LEA GAMEOVER2,A1
000065F4                          1487              
000065F4  303C 000E               1488              MOVE.W #14,D0
000065F8  4E4F                    1489              TRAP #15
000065FA                          1490              
000065FA  43F8 2CE0               1491              LEA GAMEOVER3,A1
000065FE  303C 000E               1492              MOVE.W #14,D0
00006602  4E4F                    1493              TRAP #15
00006604                          1494              
00006604  43F8 2D26               1495              LEA GAMEOVER4,A1
00006608  303C 000E               1496              MOVE.W #14,D0
0000660C  4E4F                    1497              TRAP #15
0000660E                          1498              
0000660E  43F8 2D6A               1499              LEA GAMEOVER5,A1
00006612  303C 000E               1500              MOVE.W #14,D0
00006616  4E4F                    1501              TRAP #15
00006618                          1502              
00006618                          1503  
00006618  FFFF FFFF               1504              SIMHALT            
0000661C                          1505             
0000661C                          1506              
0000661C                          1507              
0000661C                          1508              
0000661C                          1509  
0000661C                          1510  
0000661C                          1511              
0000661C                          1512  
0000661C                          1513  
0000661C                          1514              
0000661C                          1515  .DONE
0000661C  4C9F 00FF               1516              MOVEM.W (A7)+,D0-D7
00006620  4E75                    1517              RTS
00006622                          1518  
00006622                          1519              
00006622                          1520  ; ------------------------------------------------------------------------------
00006622                          1521  BALPLOT
00006622                          1522  ; PLOT THE BALL.
00006622                          1523  ; INPUT    : A0 POINTER TO THE INSTANCE VARIABLES 
00006622                          1524  ; OUTPUT   : NONE
00006622                          1525  ; MODIFIES : NONE
00006622                          1526  ; ------------------------------------------------------------------------------
00006622  48E7 F800               1527             MOVEM.L D0-D4,-(A7)
00006626                          1528              
00006626                          1529              
00006626                          1530              
00006626                          1531              ; PONEMOS PEN COLOR
00006626  103C 0050               1532              MOVE.B  #80,D0
0000662A  223C 00FF0000           1533              MOVE.L  #$00FF0000,D1
00006630  4E4F                    1534              TRAP    #15
00006632                          1535              
00006632                          1536              ; PONEMOS FILL COLOR
00006632  103C 0051               1537              MOVE.B  #81,D0
00006636  223C 00FF0000           1538              MOVE.L  #$00FF0000,D1
0000663C  4E4F                    1539              TRAP    #15
0000663E                          1540              
0000663E                          1541              ; DEFINIMOS COORDENADAS
0000663E  3210                    1542              MOVE.W  (A0),D1
00006640  0441 0014               1543              SUB.W   #BALRAD,D1
00006644  3428 0002               1544              MOVE.W  2(A0),D2
00006648  0442 0014               1545              SUB.W   #BALRAD,D2
0000664C  3601                    1546              MOVE.W  D1,D3
0000664E  0643 0028               1547              ADD.W   #2*BALRAD,D3
00006652  3802                    1548              MOVE.W  D2,D4
00006654  0644 0028               1549              ADD.W   #2*BALRAD,D4
00006658                          1550              
00006658                          1551              ; DIBUJAMOS EL CIRCULO
00006658  103C 0058               1552              MOVE.B  #88,D0
0000665C  4E4F                    1553              TRAP    #15
0000665E                          1554              
0000665E  4CDF 001F               1555              MOVEM.L (A7)+,D0-D4
00006662                          1556  
00006662  4E75                    1557              RTS
00006664                          1558  
00006664                          1559  
00006664                          1560  
00006664                          1561  
00006664                          1562  
00006664                          1563  
00006664                          1564  -------------------- end include --------------------
00006664                          1565              INCLUDE "DMMCONST.X68"
00006664                          1566  ; =============================================================================
00006664                          1567  ; DYNAMIC MEMORY MANAGEMENT CONSTANTS (SYSTEM CONSTANTS)
00006664                          1568  ; =============================================================================
00006664                          1569  
00006664  =00000040               1570  DMMBSIZE    EQU     64                      ; BLOCK SIZE (BYTES). POWER OF TWO
00006664  =00000032               1571  DMMBNUM     EQU     50                      ; NUMBER OF BLOCKS
00006664  =00000000               1572  DMMSYSID    EQU     0                       ; SYSTEM OWNER ID (MUST BE 0)
00006664  =00000000               1573  -------------------- end include --------------------
00006664                          1574              INCLUDE "DMMVARS.X68"
00006664                          1575  ; =============================================================================
00006664                          1576  ; DYNAMIC MEMORY MANAGEMENT VARIABLES (SYSTEM VARIABLES)
00006664                          1577  ; =============================================================================
00006664                          1578  
00006680                          1579              ORG     (*+DMMBSIZE-1)&-DMMBSIZE ; ALIGN TO DMMBSIZE
00006680                          1580  DMMDATA     DS.B    DMMBSIZE*DMMBNUM        ; DYNAMIC MEMORY ALLOCATION SPACE
00007300                          1581              DS.W    0                       ; JUST IN CASE (SIZE IS POW OF TWO)
00007300                          1582  -------------------- end include --------------------
00007300                          1583              
00007300                          1584              INCLUDE "DMMCODE.X68"
00007300                          1585  ; =============================================================================
00007300                          1586  ; DYNAMIC MEMORY MANAGEMENT (SYSTEM CODE)
00007300                          1587  ; DYNAMIC MEMORY IS A SET OF DMMBNUM SLOTS OF DMMBSIZE BYTES EACH ONE.
00007300                          1588  ; DMMBSIZE MUST BE POWER OF TWO. A SLOT HAS:
00007300                          1589  ; - HEADER - 1 WORD. SPECIFIES THE OWNER (0 MEANS OWNED BY SYSTEM)
00007300                          1590  ; - DATA   - DMMBSIZE - 2 BYTES. MAY CONTAIN VARS AND ANY KIND OF DATA RELATED
00007300                          1591  ;            THE THE OWNER. IF OWNER==0, DATA IS MEANINGLESS.
00007300                          1592  ; =============================================================================
00007300                          1593  
00007300                          1594  ; -----------------------------------------------------------------------------
00007300                          1595  DMMINIT
00007300                          1596  ; INITIALIZES THE DYNAMIC MEMORY TO ALL OWNED BY SYSTEM.
00007300                          1597  ; INPUT    - NONE
00007300                          1598  ; OUTPUT   - NONE
00007300                          1599  ; MODIFIES - NONE
00007300                          1600  ; -----------------------------------------------------------------------------
00007300  48E7 8080               1601              MOVEM.L D0/A0,-(A7)
00007304  41F8 6680               1602              LEA     DMMDATA,A0
00007308  303C 0031               1603              MOVE.W  #DMMBNUM-1,D0
0000730C  30BC 0000               1604  .LOOP       MOVE.W  #DMMSYSID,(A0)
00007310  D1FC 00000040           1605              ADD.L   #DMMBSIZE,A0
00007316  51C8 FFF4               1606              DBRA.W  D0,.LOOP
0000731A  4CDF 0101               1607              MOVEM.L (A7)+,D0/A0
0000731E  4E75                    1608              RTS
00007320                          1609  
00007320                          1610  ; -----------------------------------------------------------------------------
00007320                          1611  DMMFIRST
00007320                          1612  ; SEARCHES THE FIRST MEMORY SLOT NOT OWNED BY SYSTEM AND OUTPUTS A POINTER
00007320                          1613  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
00007320                          1614  ; INPUT    - NONE
00007320                          1615  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
00007320                          1616  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00007320                          1617  ; -----------------------------------------------------------------------------
00007320  41F8 6680               1618              LEA     DMMDATA,A0
00007324  4A58                    1619  DMMFRLOP    TST.W   (A0)+
00007326  6600 0016               1620              BNE     DMMFRFND
0000732A  D1FC 0000003E           1621              ADD.L   #DMMBSIZE-2,A0
00007330  B1FC 000072FF           1622  DMMFRCOM    CMP.L   #DMMDATA+DMMBSIZE*DMMBNUM-1,A0
00007336  6DEC                    1623              BLT     DMMFRLOP
00007338  207C 00000000           1624              MOVE.L  #0,A0
0000733E  4E75                    1625  DMMFRFND    RTS
00007340                          1626  
00007340                          1627  ; -----------------------------------------------------------------------------
00007340                          1628  DMMNEXT
00007340                          1629  ; SEARCHES THE NEXT MEMORY SLOT NOT OWNED BY SYSTEM AND OUTPUTS A POINTER
00007340                          1630  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
00007340                          1631  ; INPUT    - A0   : POINTER WITHIN THE CURRENT SLOT
00007340                          1632  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
00007340                          1633  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00007340                          1634  ; -----------------------------------------------------------------------------
00007340  2F00                    1635              MOVE.L  D0,-(A7)
00007342  2008                    1636              MOVE.L  A0,D0
00007344  C0BC FFFFFFC0           1637              AND.L   #-DMMBSIZE,D0           ; TAKE ADVANTAGE OF ALIGNMENT
0000734A  0680 00000040           1638              ADD.L   #DMMBSIZE,D0
00007350  2040                    1639              MOVE.L  D0,A0
00007352  201F                    1640              MOVE.L  (A7)+,D0
00007354  60DA                    1641              BRA     DMMFRCOM
00007356                          1642  
00007356                          1643  ; -----------------------------------------------------------------------------
00007356                          1644  DMMFRSTO
00007356                          1645  ; SEARCHES THE FIRST MEMORY SLOT WITH THE SPECIFIED ID AND OUTPUTS A POINTER
00007356                          1646  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
00007356                          1647  ; INPUT    - D0.W : ID TO SEARCH
00007356                          1648  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
00007356                          1649  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00007356                          1650  ; -----------------------------------------------------------------------------
00007356  41F8 6680               1651              LEA     DMMDATA,A0
0000735A  B058                    1652  DMMFLOOP    CMP.W   (A0)+,D0
0000735C  6700 0016               1653              BEQ     DMMFFND
00007360  D1FC 0000003E           1654              ADD.L   #DMMBSIZE-2,A0
00007366  B1FC 000072FF           1655  DMMFCOM     CMP.L   #DMMDATA+DMMBSIZE*DMMBNUM-1,A0
0000736C  6DEC                    1656              BLT     DMMFLOOP
0000736E  207C 00000000           1657              MOVE.L  #0,A0
00007374  4E75                    1658  DMMFFND     RTS
00007376                          1659  
00007376                          1660  ; -----------------------------------------------------------------------------
00007376                          1661  DMMNEXTO
00007376                          1662  ; SEARCHES THE NEXT MEMORY SLOT WITH THE SPECIFIED ID AND OUTPUTS A POINTER
00007376                          1663  ; TO THE CORRESPONDING DATA (SLOT ADDRESS+2)
00007376                          1664  ; INPUT    - D0.W : ID TO SEARCH
00007376                          1665  ;            A0   : POINTER WITHIN THE CURRENT SLOT
00007376                          1666  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FOUND
00007376                          1667  ; MODIFIES - NONE (ASIDE OF OUTPUT)
00007376                          1668  ; -----------------------------------------------------------------------------
00007376  2F00                    1669              MOVE.L  D0,-(A7)
00007378  2008                    1670              MOVE.L  A0,D0
0000737A  C0BC FFFFFFC0           1671              AND.L   #-DMMBSIZE,D0           ; TAKE ADVANTAGE OF ALIGNMENT
00007380  0680 00000040           1672              ADD.L   #DMMBSIZE,D0
00007386  2040                    1673              MOVE.L  D0,A0
00007388  201F                    1674              MOVE.L  (A7)+,D0
0000738A  60DA                    1675              BRA     DMMFCOM
0000738C                          1676  
0000738C                          1677  ; -----------------------------------------------------------------------------
0000738C                          1678  DMMALLOC
0000738C                          1679  ; SEARCHES THE FIRST FREE (SYS OWNED) SLOT, ASSIGNS TO THE SPECIFIED OWNER
0000738C                          1680  ; AND RETURNS A POINTER TO THE CORRESPONDING DATA (SLOT ADDRESS + 2)
0000738C                          1681  ; INPUT    - D0.W : ID TO ASSIGN
0000738C                          1682  ; OUTPUT   - A0   : POINTER TO THE DATA OR 0 IF NOT FREE SPACE
0000738C                          1683  ; MODIFIES - NONE (ASIDE OF OUTPUT)
0000738C                          1684  ; -----------------------------------------------------------------------------
0000738C  3F00                    1685              MOVE.W  D0,-(A7)
0000738E  4240                    1686              CLR.W   D0
00007390  4EB8 7356               1687              JSR     DMMFRSTO
00007394  301F                    1688              MOVE.W  (A7)+,D0
00007396  B1FC 00000000           1689              CMP.L   #0,A0
0000739C  6700 0006               1690              BEQ     .END
000073A0  3140 FFFE               1691              MOVE.W  D0,-2(A0)
000073A4  4E75                    1692  .END        RTS
000073A6                          1693  
000073A6                          1694  ; -----------------------------------------------------------------------------
000073A6                          1695  DMMFREE
000073A6                          1696  ; FREES THE SLOT TO WHICH THE PROVIDED POINTER BELONGS BY SETTING ITS OWNED TO
000073A6                          1697  ; SYSTEM (0)
000073A6                          1698  ; INPUT    - A0   : POINTER BELONGING TO THE SLOT TO FREE
000073A6                          1699  ; OUTPUT   - NONE
000073A6                          1700  ; MODIFIES - NONE
000073A6                          1701  ; -----------------------------------------------------------------------------
000073A6  48E7 8080               1702              MOVEM.L D0/A0,-(A7)
000073AA  2008                    1703              MOVE.L  A0,D0
000073AC  C0BC FFFFFFC0           1704              AND.L   #-DMMBSIZE,D0           ; TAKE ADVANTAGE OF ALIGNMENT
000073B2  2040                    1705              MOVE.L  D0,A0
000073B4  4250                    1706              CLR.W   (A0)
000073B6  4CDF 0101               1707              MOVEM.L (A7)+,D0/A0
000073BA  4E75                    1708              RTS
000073BA  4E75                    1709  -------------------- end include --------------------
000073BC                          1710              INCLUDE "UTLCODE.X68"
000073BC                          1711  ; =============================================================================
000073BC                          1712  ; UTILITY CODE
000073BC                          1713  ; =============================================================================
000073BC= A2 EE 9A 0C F5 24 ...   1714  RANDVEC    DC.B    162, 238, 154, 12 , 245, 36 , 32 , 103
000073C4= 2A A3 51 26 E0 AC ...   1715              DC.B    42 , 163, 81 , 38 , 224, 172, 19 , 69
000073CC= 75 51 CA FD 33 EB ...   1716              DC.B    117, 81 , 202, 253, 51 , 235, 108, 154
000073D4= 60 CC E7 B8 9A EB ...   1717              DC.B    96 , 204, 231, 184, 154, 235, 34 , 203
000073DC= 1D 76 B5 95 B0 89 ...   1718              DC.B    29 , 118, 181, 149, 176, 137, 62 , 108
000073E4= 39 15 48 C9 6E CA ...   1719              DC.B    57 , 21 , 72 , 201, 110, 202, 159, 41
000073EC= 43 E7 E2 7C 37 25 ...   1720              DC.B    67 , 231, 226, 124, 55 , 37 , 84 , 62
000073F4= E9 94 CE E9 E4 52 ...   1721              DC.B    233, 148, 206, 233, 228, 82 , 243, 78
000073FC= 37 6D 9A 84 A2 28 ...   1722              DC.B    55 , 109, 154, 132, 162, 40 , 30 , 39
00007404= 19 E2 C6 77 80 D4 ...   1723              DC.B    25 , 226, 198, 119, 128, 212, 232, 225
0000740C= 0A 5A 32 67 33 C2 ...   1724              DC.B    10 , 90 , 50 , 103, 51 , 194, 222, 40
00007414= 59 80 DC 0E 57 FC ...   1725              DC.B    89 , 128, 220, 14 , 87 , 252, 243, 252
0000741C= 8A AB BC F7 07 4D ...   1726              DC.B    138, 171, 188, 247, 7  , 77 , 29 , 234
00007424= EF D5 77 6E 1E BB ...   1727              DC.B    239, 213, 119, 110, 30 , 187, 131, 23
0000742C= D6 E0 2A 8F BD 28 ...   1728              DC.B    214, 224, 42 , 143, 189, 40 , 212, 130
00007434= 13 4F 66 EC 0A 64 ...   1729              DC.B    19 , 79 , 102, 236, 10 , 100, 122, 188
0000743C= 56 52 9A 16 9B 90 ...   1730              DC.B    86 , 82 , 154, 22 , 155, 144, 7  , 199
00007444= 06 8A A4 F7 01 DA ...   1731              DC.B    6  , 138, 164, 247, 1  , 218, 166, 82
0000744C= F2 E7 77 28 B1 76 ...   1732              DC.B    242, 231, 119, 40 , 177, 118, 220, 102
00007454= A4 42 E3 81 B1 67 ...   1733              DC.B    164, 66 , 227, 129, 177, 103, 165, 108
0000745C= BF CE FA 16 BF 38 ...   1734              DC.B    191, 206, 250, 22 , 191, 56 , 30 , 161
00007464= D1 8B 50 0C 5F 49 ...   1735              DC.B    209, 139, 80 , 12 , 95 , 73 , 168, 56
0000746C= DE 4C 14 A2 40 DC ...   1736              DC.B    222, 76 , 20 , 162, 64 , 220, 93 , 12
00007474= B6 9B 0A 38 5D AB ...   1737              DC.B    182, 155, 10 , 56 , 93 , 171, 89 , 6
0000747C= E2 1B DD 75 15 82 ...   1738              DC.B    226, 27 , 221, 117, 21 , 130, 101, 18
00007484= 8A 26 51 30 9F 47 ...   1739              DC.B    138, 38 , 81 , 48 , 159, 71 , 57 , 21
0000748C= 1E 8A BB 71 C6 6E ...   1740              DC.B    30 , 138, 187, 113, 198, 110, 185, 152
00007494= 9F 47 E5 34 94 27 ...   1741              DC.B    159, 71 , 229, 52 , 148, 39 , 77 , 6
0000749C= 7D 06 D6 BA 30 0F ...   1742              DC.B    125, 6  , 214, 186, 48 , 15 , 212, 22
000074A4= EC 7F 7E 03 CF 2D ...   1743              DC.B    236, 127, 126, 3  , 207, 45 , 193, 2
000074AC= 94 5B 23 F2 8B CD ...   1744              DC.B    148, 91 , 35 , 242, 139, 205, 248, 237
000074B4= 74 33 EC B9 0F D5 ...   1745              DC.B    116, 51 , 236, 185, 15 , 213, 221, 6
000074BC                          1746              DS.W    0
000074BC                          1747  
000074BC                          1748  UTLRNDIX    DS.B    1                       ; NEXT INDEX TO RANDOM NUMBER
000074BE                          1749              DS.W    0
000074BE                          1750  
000074BE                          1751  
000074BE                          1752  
000074BE                          1753  ; -----------------------------------------------------------------------------
000074BE                          1754  UTLINIT
000074BE                          1755  ; INITIALIZES UTILITY CODE
000074BE                          1756  ; INPUT    - NONE
000074BE                          1757  ; OUTPUT   - NONE
000074BE                          1758  ; MODIFIES - NONE
000074BE                          1759  ; -----------------------------------------------------------------------------
000074BE  48E7 C000               1760              MOVEM.L D0-D1,-(A7)
000074C2  103C 0008               1761              MOVE.B  #8,D0
000074C6  4E4F                    1762              TRAP    #15
000074C8  11C1 74BC               1763              MOVE.B  D1,(UTLRNDIX)
000074CC  4CDF 0003               1764              MOVEM.L (A7)+,D0-D1
000074D0  4E75                    1765              RTS
000074D2                          1766  
000074D2                          1767  ; -----------------------------------------------------------------------------
000074D2                          1768  UTLRAND
000074D2                          1769  ; PROVIDES A PSEUDO-RANDOM BYTE
000074D2                          1770  ; INPUT    - NONE
000074D2                          1771  ; OUTPUT   - D0.L RANDOM VALUE (ONLY BYTE)
000074D2                          1772  ; MODIFIES - NONE (ASIDE OF OUTPUT)
000074D2                          1773  ; -----------------------------------------------------------------------------
000074D2  2F08                    1774              MOVE.L  A0,-(A7)
000074D4  41F8 73BC               1775              LEA     RANDVEC,A0
000074D8  4280                    1776              CLR.L   D0
000074DA  1038 74BC               1777              MOVE.B  (UTLRNDIX),D0
000074DE  1030 0800               1778              MOVE.B  (A0,D0.L),D0
000074E2  5238 74BC               1779              ADDQ.B  #1,(UTLRNDIX)
000074E6  205F                    1780              MOVE.L  (A7)+,A0
000074E8  4E75                    1781              RTS
000074EA                          1782  ; -----------------------------------------------------------------------------
000074EA                          1783  UTLCHCOL
000074EA                          1784  ; CHECKS COLLISION
000074EA                          1785  ; INPUT    - D0.W X0 COORDINATE
000074EA                          1786  ;            D1.W Y0 COORDINATE
000074EA                          1787  ;            D2.W X1 COORDINATE
000074EA                          1788  ;            D3.W Y1 COORDINATE
000074EA                          1789  ;            D4.W WIDTH 0
000074EA                          1790  ;            D5.W WIDTH 1
000074EA                          1791  ;            D6.W HEIGHT 0
000074EA                          1792  ;            D7.W HEIGHT 1
000074EA                          1793  ; OUTPUT   - D0.B=FF - COLLISION, =0 - NO COLLISION
000074EA                          1794  ; MODIFIES - NONE
000074EA                          1795  ; -----------------------------------------------------------------------------
000074EA  48A7 0F00               1796              MOVEM.W D4-D7,-(A7)
000074EE  D840                    1797              ADD.W   D0,D4
000074F0  B842                    1798              CMP.W   D2,D4
000074F2  6F00 0022               1799              BLE     .NOCOL
000074F6  DA42                    1800              ADD.W   D2,D5
000074F8  BA40                    1801              CMP.W   D0,D5
000074FA  6F00 001A               1802              BLE     .NOCOL
000074FE  DC41                    1803              ADD.W   D1,D6
00007500  BC43                    1804              CMP.W   D3,D6
00007502  6F00 0012               1805              BLE     .NOCOL
00007506  DE43                    1806              ADD.W   D3,D7
00007508  BE41                    1807              CMP.W   D1,D7
0000750A  6F00 000A               1808              BLE     .NOCOL
0000750E  103C 00FF               1809              MOVE.B  #$FF,D0
00007512  6000 0004               1810              BRA     .END
00007516  4200                    1811  .NOCOL      CLR.B   D0
00007518  4C9F 00F0               1812  .END        MOVEM.W (A7)+,D4-D7
0000751C  4E75                    1813              RTS
0000751E                          1814  
0000751E                          1815  
0000751E                          1816  
0000751E                          1817  -------------------- end include --------------------
0000751E                          1818              INCLUDE "AGL.X68"
0000751E                          1819  
0000751E                          1820   ; =============================================================================
0000751E                          1821  ; AGENT MANAGEMENT
0000751E                          1822  ; EACH AGENT HAS A DATA BLOCK FROM DMM AS FOLLOWS:
0000751E                          1823  ; +0 - LONG : UPDATE SUBROUTINE POINTER
0000751E                          1824  ; +4 - LONG : PLOT SUBROUTINE POINTER
0000751E                          1825  ; +8:END    : DATA (AGENT SPECIFIC)
0000751E                          1826  ; =============================================================================
0000751E                          1827  
0000751E                          1828  ; -----------------------------------------------------------------------------
0000751E                          1829  AGLADD
0000751E                          1830  ; CREATES A NEW AGENT
0000751E                          1831  ; INPUT    - A1 - POINTER TO AGENT INIT FUNCTION
0000751E                          1832  ;            A2 - POINTER TO AGENT UPDATE FUNCTION
0000751E                          1833  ;            A3 - POINTER TO AGENT PLOT FUNCTION
0000751E                          1834  ;            D0 - AGENT TYPE (USED AS OWNER BY DMM)
0000751E                          1835  ;            D1 - AGENT INITIALIZATION PARAMETER 1
0000751E                          1836  ;            D2 - AGENT INITIALIZATION PARAMETER 2
0000751E                          1837  ;            D3 - AGENT INITIALIZATION PARAMETER 3
0000751E                          1838  ; OUTPUT   - NONE
0000751E                          1839  ; MODIFIES - NONE
0000751E                          1840  ; -----------------------------------------------------------------------------
0000751E  2F08                    1841              MOVE.L  A0,-(A7)
00007520  4EB8 738C               1842              JSR     DMMALLOC
00007524  B1FC 00000000           1843              CMP.L   #0,A0
0000752A  6700 0008               1844              BEQ     .END
0000752E  20CA                    1845              MOVE.L  A2,(A0)+
00007530  20CB                    1846              MOVE.L  A3,(A0)+
00007532  4E91                    1847              JSR     (A1)
00007534  205F                    1848  .END        MOVE.L  (A7)+,A0
00007536  4E75                    1849              RTS
00007538                          1850  
00007538                          1851  ; -----------------------------------------------------------------------------
00007538                          1852  AGLUPD
00007538                          1853  ; UPDATES THE AGENT LIST. PRIOR TO CALLING THE UPDATE FUNCTIONS, A0 IS SET
00007538                          1854  ; TO THE DATA BLOCK OF THE CORRESPONDING SLOT.
00007538                          1855  ; INPUT    - NONE
00007538                          1856  ; OUTPUT   - NONE
00007538                          1857  ; MODIFIES - NONE
00007538                          1858  ; -----------------------------------------------------------------------------
00007538  48E7 00C0               1859              MOVEM.L A0-A1,-(A7)
0000753C  4EB8 7320               1860              JSR     DMMFIRST
00007540  B1FC 00000000           1861  .LOOP       CMP.L   #0,A0
00007546  6700 000E               1862              BEQ     .END
0000754A  2250                    1863              MOVE.L  (A0),A1
0000754C  5088                    1864              ADD.L   #8,A0
0000754E  4E91                    1865              JSR     (A1)
00007550  4EB8 7340               1866              JSR     DMMNEXT
00007554  60EA                    1867              BRA     .LOOP
00007556  4CDF 0300               1868  .END        MOVEM.L (A7)+,A0-A1
0000755A  4E75                    1869              RTS
0000755C                          1870  
0000755C                          1871  ; -----------------------------------------------------------------------------
0000755C                          1872  AGLPLOT
0000755C                          1873  ; PLOTS THE AGENT LIST. PRIOR TO CALLING THE UPDATE FUNCTIONS, A0 IS SET
0000755C                          1874  ; TO THE DATA BLOCK OF THE CORRESPONDING SLOT.
0000755C                          1875  ; INPUT    - NONE
0000755C                          1876  ; OUTPUT   - NONE
0000755C                          1877  ; MODIFIES - NONE
0000755C                          1878  ; -----------------------------------------------------------------------------
0000755C  48E7 00C0               1879              MOVEM.L A0-A1,-(A7)
00007560  4EB8 7320               1880              JSR     DMMFIRST
00007564  B1FC 00000000           1881  .LOOP       CMP.L   #0,A0
0000756A  6700 0010               1882              BEQ     .END
0000756E  2268 0004               1883              MOVE.L  4(A0),A1
00007572  5088                    1884              ADD.L   #8,A0
00007574  4E91                    1885              JSR     (A1)
00007576  4EB8 7340               1886              JSR     DMMNEXT
0000757A  60E8                    1887              BRA     .LOOP
0000757C  4CDF 0300               1888  .END        MOVEM.L (A7)+,A0-A1
00007580  4E75                    1889              RTS
00007582                          1890  
00007582                          1891  ; -----------------------------------------------------------------------------
00007582  =000073A6               1892  AGLKILL     EQU     DMMFREE
00007582                          1893  ; KILLS THE AGENT BY RELEASING ITS MEMORY
00007582                          1894  ; INPUT    - A0 POINTER WITHIN THE AGENT MEMORY
00007582                          1895  ; OUTPUT   - NONE
00007582                          1896  ; MODIFIES - NONE
00007582                          1897  ; NOTE     - IT IS JUST A WRAPPER FOR DMMFREE
00007582                          1898  ; -----------------------------------------------------------------------------
00007582                          1899  
00007582                          1900  
00007582                          1901  
00007582                          1902  -------------------- end include --------------------
00007582                          1903              INCLUDE "PLATAFORM.X68"
00007582                          1904  ; ==============================================================================
00007582                          1905  ; PLATAFORMA MANAGEMENT
00007582                          1906  ;X CENTER: (A0)
00007582                          1907  ;Y CENTER: 2(A0)
00007582                          1908  ;MOVX:     4(A0)
00007582                          1909  ;MOVY:     6(A0)
00007582                          1910  ; ==============================================================================
00007582                          1911  ;CADA INIT PARA UNA DIFERENTE POSICION DE LA PLATAFORMA            
00007582                          1912  ; ------------------------------------------------------------------------------
00007582                          1913  PINIT
00007582                          1914  ; INITIALIZE PLATAFORMA 0.
00007582                          1915  ; INPUT    : NONE 
00007582                          1916  ; OUTPUT   : NONE
00007582                          1917  ; MODIFIES : XCENTER, YCENTER, MOVIMIENTO
00007582                          1918  ; ------------------------------------------------------------------------------
00007582  30BC 0064               1919      MOVE.W  #100, (A0)          ;INICIALIZAR COORDENADAS DE PLATAFORMA
00007586  317C 015E 0002          1920      MOVE.W  #350, 2(A0)
0000758C  317C 0001 0004          1921      MOVE.W  #1, 4(A0)
00007592  317C 0001 0006          1922      MOVE.W  #1, 6(A0)
00007598  4E75                    1923      RTS
0000759A                          1924  ; ------------------------------------------------------------------------------
0000759A                          1925  PINIT1
0000759A                          1926  ; INITIALIZE PLATAFORMA 1.
0000759A                          1927  ; INPUT    : NONE 
0000759A                          1928  ; OUTPUT   : NONE
0000759A                          1929  ; MODIFIES : XCENTER, YCENTER, MOVIMIENTO
0000759A                          1930  ; ------------------------------------------------------------------------------
0000759A  30BC 0064               1931      MOVE.W  #100, (A0)          ;INICIALIZAR COORDENADAS DE PLATAFORMA
0000759E  317C 00C8 0002          1932      MOVE.W  #200, 2(A0)
000075A4  317C 0005 0004          1933      MOVE.W  #5, 4(A0)
000075AA  317C 0001 0006          1934      MOVE.W  #1, 6(A0)
000075B0  4E75                    1935      RTS
000075B2                          1936      
000075B2                          1937  ; ------------------------------------------------------------------------------
000075B2                          1938  PINIT2
000075B2                          1939  ; INITIALIZE PLATAFORMA 2.
000075B2                          1940  ; INPUT    : NONE 
000075B2                          1941  ; OUTPUT   : NONE
000075B2                          1942  ; MODIFIES : XCENTER, YCENTER, MOVIMIENTO
000075B2                          1943  ; ------------------------------------------------------------------------------
000075B2  30BC 01F4               1944      MOVE.W  #500, (A0)          ;INICIALIZAR COORDENADAS DE PLATAFORMA
000075B6  317C 0000 0002          1945      MOVE.W  #0, 2(A0)
000075BC  317C 0005 0004          1946      MOVE.W  #5, 4(A0)
000075C2  317C 0003 0006          1947      MOVE.W  #3, 6(A0)
000075C8  4E75                    1948      RTS
000075CA                          1949      
000075CA                          1950  ; ------------------------------------------------------------------------------    
000075CA                          1951  PUPDATE
000075CA                          1952  ; UPDATE PLATFORM COORDINATES, IF IT COLLIDES WITH A WALL, 
000075CA                          1953  ; DENY MOVEMENT TO UPDATE THE COORDINATE. THAT UPDATE IS USED FOR HORIZONTAL PLATFORMS
000075CA                          1954  ; INPUT    : NONE
000075CA                          1955  ; OUTPUT   : NONE
000075CA                          1956  ; MODIFIES : XCENTER
000075CA                          1957  ; ------------------------------------------------------------------------------
000075CA                          1958      
000075CA  48A7 FC00               1959      MOVEM.W D0-D5,-(A7)
000075CE                          1960  
000075CE  3010                    1961      MOVE.W (A0),D0
000075D0  3228 0002               1962      MOVE.W  2(A0),D1
000075D4                          1963      
000075D4  D068 0004               1964      ADD.W   4(A0),D0
000075D8                          1965      
000075D8                          1966      ; COMPARA SI CHOCA PARED
000075D8  B07C 0280               1967      CMP.W   #SCRWIDTH, D0
000075DC  6500 000E               1968      BLO .UPAUX
000075E0  4468 0004               1969      NEG.W   4(A0)
000075E4  D068 0004               1970      ADD.W   4(A0),D0
000075E8  6000 0004               1971      BRA .F
000075EC                          1972  .UPAUX
000075EC  3080                    1973      MOVE.W  D0, (A0) 
000075EE                          1974  .F          
000075EE                          1975              ;MIRAMOS SI HAY COLISIONES EN LA PARTE SUPERIOR
000075EE                          1976  
000075EE                          1977  
000075EE  5F41                    1978              SUB.W #CALTURA/2,D1
000075F0  0440 0032               1979              SUB.W #CANCHURA/2,D0
000075F4                          1980              
000075F4  3438 5E5C               1981              MOVE.W (PLRPOSX),D2
000075F8  3638 5E5E               1982              MOVE.W (PLRPOSY),D3
000075FC  0643 001E               1983              ADD.W   #PLRHEIGH,D3
00007600  383C 0064               1984              MOVE.W #CANCHURA,D4
00007604  3A3C 001E               1985              MOVE.W #PLRWIDTH,D5
00007608                          1986              ;USAMOS CONSTANTES PARA TENER UNICAMENTE LA PARTE
00007608                          1987              ;DE ARRIBA DE LA PLATAFORMA PARA DETECTAR LA COLISIÓN
00007608  3C3C 000A               1988              MOVE.W #10,D6
0000760C  3E3C 0005               1989              MOVE.W #5,D7
00007610                          1990              
00007610  4EB8 74EA               1991              JSR     UTLCHCOL
00007614                          1992              
00007614                          1993              
00007614  B03C 00FF               1994              CMP.B   #$FF,D0
00007618  6600 001C               1995              BNE .FIN
0000761C                          1996              ;AJUSTAMOS ENCIMA DE LA PLATAFORMA
0000761C  31E8 0002 5E5E          1997              MOVE.W  2(A0),(PLRPOSY)
00007622  5F78 5E5E               1998              SUB.W   #CALTURA/2,(PLRPOSY)
00007626  0478 001E 5E5E          1999              SUB.W   #PLRHEIGH,(PLRPOSY)
0000762C  31FC 0002 5E64          2000              MOVE.W  #GRAVEDAD,(VGRAVEDAD)
00007632  6000 0002               2001              BRA     .FIN
00007636                          2002              
00007636                          2003      
00007636                          2004  .FIN   
00007636                          2005      
00007636  4C9F 003F               2006      MOVEM.W (A7)+,D0-D5
0000763A                          2007  
0000763A  4E75                    2008      RTS    
0000763C                          2009  
0000763C                          2010  ; ------------------------------------------------------------------------------        
0000763C                          2011  PUPDATE1
0000763C                          2012  ; UPDATE PLATFORM COORDINATES, IF IT COLLIDES WITH A WALL, 
0000763C                          2013  ; DENY MOVEMENT TO UPDATE THE COORDINATE.THAT UPDATE IS USED FOR VERTICAL PLATFORMS
0000763C                          2014  ; INPUT    : NONE
0000763C                          2015  ; OUTPUT   : NONE
0000763C                          2016  ; MODIFIES : XCENTER
0000763C                          2017  ; ------------------------------------------------------------------------------
0000763C                          2018      ;LA UNICA DIFERENCIA ES QUE AQUÍ MODIFICAMOS LA VELOCIDAD DE Y
0000763C                          2019      ; Y LA POSICIÓN EN Y DE LA PLATAFORMA
0000763C  48A7 FC00               2020      MOVEM.W D0-D5,-(A7)
00007640                          2021  
00007640  3010                    2022      MOVE.W (A0),D0
00007642  3228 0002               2023      MOVE.W  2(A0),D1
00007646                          2024      
00007646  D268 0006               2025      ADD.W   6(A0),D1
0000764A                          2026      
0000764A                          2027      ; COMPARA SI CHOCA PARED
0000764A  B27C 01E0               2028      CMP.W   #SCRHEIGH, D1
0000764E  6500 000E               2029      BLO .UPAUX
00007652  4468 0006               2030      NEG.W   6(A0)
00007656  D268 0006               2031      ADD.W   6(A0),D1
0000765A  6000 0006               2032      BRA .F
0000765E                          2033  .UPAUX
0000765E  3141 0002               2034      MOVE.W  D1, 2(A0) 
00007662                          2035  .F          
00007662                          2036              ;MIRAMOS SI HAY COLISIONES EN LA PARTE SUPERIOR
00007662                          2037                          
00007662                          2038           
00007662                          2039  
00007662  5F41                    2040              SUB.W #CALTURA/2,D1
00007664  0440 0032               2041              SUB.W #CANCHURA/2,D0
00007668                          2042              
00007668  3438 5E5C               2043              MOVE.W (PLRPOSX),D2
0000766C  3638 5E5E               2044              MOVE.W (PLRPOSY),D3
00007670  0643 001E               2045              ADD.W   #PLRHEIGH,D3
00007674  383C 0064               2046              MOVE.W #CANCHURA,D4
00007678  3A3C 001E               2047              MOVE.W #PLRWIDTH,D5
0000767C                          2048               ;USAMOS CONSTANTES PARA TENER UNICAMENTE LA PARTE
0000767C                          2049              ;DE ARRIBA DE LA PLATAFORMA PARA DETECTAR LA COLISIÓN
0000767C  3C3C 000A               2050              MOVE.W #10,D6
00007680  3E3C 0005               2051              MOVE.W #5,D7
00007684                          2052              
00007684  4EB8 74EA               2053              JSR     UTLCHCOL
00007688                          2054              
00007688                          2055              
00007688  B03C 00FF               2056              CMP.B   #$FF,D0
0000768C  6600 001C               2057              BNE .FIN
00007690                          2058              ;AJUSTAMOS ENCIMA DE LA PLATAFORMA
00007690  31E8 0002 5E5E          2059              MOVE.W  2(A0),(PLRPOSY)
00007696  5F78 5E5E               2060              SUB.W   #CALTURA/2,(PLRPOSY)
0000769A  0478 001E 5E5E          2061              SUB.W   #PLRHEIGH,(PLRPOSY)
000076A0  31FC 0002 5E64          2062              MOVE.W  #GRAVEDAD,(VGRAVEDAD)
000076A6  6000 0002               2063              BRA     .FIN
000076AA                          2064              
000076AA                          2065      
000076AA                          2066  .FIN   
000076AA                          2067      
000076AA  4C9F 003F               2068      MOVEM.W (A7)+,D0-D5
000076AE                          2069  
000076AE  4E75                    2070      RTS
000076B0                          2071  
000076B0                          2072  ; ------------------------------------------------------------------------------    
000076B0                          2073  PPLOT
000076B0                          2074  ; DRAW A RECTANGLE WITH HEIGHT 40 AND WIDTH 100
000076B0                          2075  ; Input    - XCENTER Y YCENTER
000076B0                          2076  ; Output   - None
000076B0                          2077  ; Modifies - Nothing
000076B0                          2078  ; -----------------------------------------------------------------------------
000076B0                          2079  
000076B0  48E7 FF00               2080              MOVEM.L D0-D7, -(A7)
000076B4  103C 0050               2081              MOVE.B  #80,D0                  
000076B8  223C 00FFFFFF           2082              MOVE.L  #$00FFFFFF,D1
000076BE  4E4F                    2083              TRAP    #15
000076C0  103C 0051               2084              MOVE.B  #81,D0                  ;-------- COLORES
000076C4  223C 00800000           2085              MOVE.L  #$00800000,D1
000076CA  4E4F                    2086              TRAP    #15
000076CC                          2087                                   
000076CC                          2088              
000076CC                          2089              
000076CC  3428 0002               2090              MOVE.W  2(A0),D2            ;-------- COORDENADAS Y
000076D0  5F42                    2091              SUB.W   #CALTURA/2,D2
000076D2  3802                    2092              MOVE.W  D2,D4
000076D4  0644 000F               2093              ADD.W   #CALTURA,D4
000076D8                          2094              
000076D8  3210                    2095              MOVE.W  (A0),D1            ;-------- COORDENADAS X
000076DA  0441 0032               2096              SUB.W   #CANCHURA/2,D1
000076DE  3601                    2097              MOVE.W  D1,D3
000076E0  0643 0064               2098              ADD.W   #CANCHURA,D3
000076E4                          2099              
000076E4  103C 0057               2100              MOVE.B  #87,D0                  ;-------- DIBUJAR
000076E8  4E4F                    2101              TRAP    #15
000076EA                          2102              
000076EA  4CDF 00FF               2103              MOVEM.L (A7)+,D0-D7   
000076EE                          2104              
000076EE  4E75                    2105              RTS 
000076F0                          2106  
000076F0                          2107  
000076F0                          2108  
000076F0                          2109  -------------------- end include --------------------
000076F0                          2110  START:                  ; first instruction of program
000076F0  42B8 5E66               2111             CLR.L VTIMER
000076F4  4EB8 7300               2112             JSR DMMINIT
000076F8  4EB8 74BE               2113             JSR UTLINIT
000076FC  4EB8 5E94               2114             JSR SCRINIT
00007700  4EB8 60C6               2115             JSR KBDINIT
00007704                          2116             
00007704  31FC 0002 5E68          2117             MOVE.W #2,(SEGUNDOS)
0000770A  4EB8 6350               2118             JSR PLRINIT
0000770E  4EB8 61DC               2119             JSR MOUSEINIT
00007712  43F8 644A               2120             LEA BALINIT,A1
00007716  45F8 64B6               2121             LEA BALUPD, A2
0000771A  47F8 6622               2122             LEA BALPLOT,A3
0000771E                          2123             
0000771E  303C 0001               2124             MOVE.W #1,D0
00007722  4EB8 751E               2125             JSR  AGLADD
00007726                          2126             
00007726  43F8 7582               2127             LEA PINIT,A1
0000772A  45F8 75CA               2128             LEA PUPDATE, A2
0000772E  47F8 76B0               2129             LEA PPLOT,A3
00007732  303C 0002               2130             MOVE.W #2,D0
00007736  4EB8 751E               2131             JSR      AGLADD
0000773A                          2132             
0000773A                          2133           
0000773A                          2134  
0000773A  31FC 0000 5E84          2135             MOVE.W #0,(PLTEN)
00007740  31FC 0000 5E86          2136             MOVE.W #0,(PLTEN1)
00007746  31FC 0000 5E88          2137             MOVE.W #0,(BALEN)
0000774C  4282                    2138              CLR.L D2
0000774E  303C 0008               2139              MOVE.W #8,D0
00007752  4E4F                    2140              TRAP #15
00007754  21C1 5E4E               2141              MOVE.L D1,(FPSIN)
00007758  4281                    2142              CLR.L D1
0000775A  4280                    2143              CLR.L D0
0000775C  0C78 0000 5E52          2144  .LOOP       CMP #0,(ENFPS)
00007762  6700 0016               2145              BEQ     .TT
00007766  303C 0008               2146              MOVE.W #8,D0
0000776A  4E4F                    2147              TRAP #15
0000776C  21C1 5E4E               2148              MOVE.L D1,(FPSIN)
00007770  4281                    2149              CLR.L D1
00007772  4280                    2150              CLR.L D0
00007774  31FC 0000 5E52          2151              MOVE.W  #0,(ENFPS)
0000777A                          2152  .TT         
0000777A                          2153              
0000777A  4EB8 5FA4               2154              JSR     SCRPLOT
0000777E  4E42                    2155              TRAP   #MOUSETRAP
00007780  4E40                    2156              TRAP   #KBDTRAP                ; READ KEYBOARD
00007782                          2157              
00007782                          2158              
00007782                          2159              
00007782                          2160              
00007782                          2161              
00007782  0C78 000F 5E66          2162              CMP #15,(VTIMER)
00007788  6600 0024               2163              BNE     .II
0000778C  0C78 0000 5E84          2164              CMP     #0,(PLTEN)
00007792  6600 001A               2165              BNE     .II
00007796  5278 5E84               2166              ADDQ #1,(PLTEN)
0000779A  43F8 759A               2167              LEA PINIT1,A1
0000779E  45F8 75CA               2168              LEA PUPDATE, A2
000077A2  47F8 76B0               2169              LEA PPLOT,A3
000077A6  303C 0002               2170              MOVE.W #2,D0
000077AA  4EB8 751E               2171              JSR      AGLADD
000077AE                          2172              
000077AE                          2173           
000077AE                          2174  
000077AE                          2175  .II
000077AE                          2176  
000077AE  0C78 001E 5E66          2177              CMP #30,(VTIMER)
000077B4  6600 0024               2178              BNE .III
000077B8  0C78 0000 5E86          2179              CMP #0,(PLTEN1)
000077BE  6600 001A               2180              BNE .III
000077C2  5278 5E86               2181              ADDQ #1,(PLTEN1)
000077C6  43F8 75B2               2182              LEA PINIT2,A1
000077CA  45F8 763C               2183              LEA PUPDATE1, A2
000077CE  47F8 76B0               2184              LEA PPLOT,A3
000077D2  303C 0002               2185              MOVE.W #2,D0
000077D6  4EB8 751E               2186              JSR      AGLADD
000077DA                          2187              
000077DA                          2188              
000077DA                          2189  .III
000077DA  4EB8 62A8               2190              JSR WIN
000077DE                          2191              
000077DE                          2192              
000077DE                          2193  
000077DE                          2194  .IV         
000077DE  3838 5E68               2195               MOVE.W (SEGUNDOS),D4
000077E2  3A38 5E66               2196              MOVE.W  (VTIMER),D5
000077E6  BA44                    2197              CMP     D4,D5
000077E8  6600 002A               2198              BNE     .WINT            
000077EC  3C38 5E88               2199              MOVE.W  (BALEN),D6
000077F0  BC44                    2200              CMP     D4,D6
000077F2  6700 0020               2201              BEQ     .WINT
000077F6  31F8 5E68 5E88          2202              MOVE.W  (SEGUNDOS),(BALEN)
000077FC  43F8 644A               2203              LEA BALINIT,A1
00007800  45F8 64B6               2204              LEA BALUPD, A2
00007804  47F8 6622               2205              LEA BALPLOT,A3
00007808  303C 0001               2206              MOVE.W #1,D0
0000780C  4EB8 751E               2207              JSR      AGLADD
00007810                          2208  
00007810                          2209              
00007810                          2210              
00007810                          2211                          
00007810                          2212              
00007810  5478 5E68               2213              ADD.W   #2,(SEGUNDOS)
00007814                          2214             
00007814                          2215             
00007814                          2216             
00007814                          2217              
00007814                          2218  .WINT 
00007814                          2219              
00007814  4EB8 6364               2220              JSR     PLRUPD
00007818  4EB8 7538               2221              JSR     AGLUPD
0000781C                          2222              
0000781C  4EB8 755C               2223              JSR     AGLPLOT
00007820  4EB8 63F2               2224              JSR     DIBUJAR
00007824                          2225              
00007824                          2226              
00007824  4A38 5E44               2227               TST.B   (SCRINTCT)              ; WAIT FOR INTERRUPT
00007828  67EA                    2228              BEQ     .WINT
0000782A  4238 5E44               2229              CLR.B   (SCRINTCT)
0000782E  303C 0008               2230              MOVE.W #8,D0
00007832  4E4F                    2231              TRAP #15
00007834  21C1 5E4A               2232              MOVE.L D1,(FPSAC)
00007838  4281                    2233              CLR.L D1
0000783A  4280                    2234              CLR.L D0
0000783C  4286                    2235              CLR.L D6
0000783E  1C38 5E45               2236              MOVE.B (SCRCYCCT),D6
00007842  BC7C 0032               2237              CMP #FPS,D6
00007846  6D00 0014               2238              BLT .YA
0000784A                          2239              
0000784A  4EB8 5F32               2240              JSR FPSUPD
0000784E  31FC 0001 5E52          2241              MOVE.W  #1,(ENFPS)
00007854  5278 5E66               2242              ADDQ.W #1,(VTIMER)
00007858  4238 5E45               2243              CLR.B   (SCRCYCCT)
0000785C                          2244  .YA           
0000785C  4E41                    2245              TRAP    #SCRTRAP                ; SHOW GRAPHICS                
0000785E                          2246              
0000785E  6000 FEFC               2247              BRA .LOOP
00007862  FFFF FFFF               2248      SIMHALT             ; halt simulator
00007866                          2249  
00007866                          2250             
00007866                          2251  
00007866                          2252      END    START        ; last line of source

No errors detected
No warnings generated


SYMBOL TABLE INFORMATION
Symbol-name         Value
-------------------------
AGLADD              751E
AGLADD:END          7534
AGLKILL             73A6
AGLPLOT             755C
AGLPLOT:END         757C
AGLPLOT:LOOP        7564
AGLUPD              7538
AGLUPD:END          7556
AGLUPD:LOOP         7540
BALEN               5E88
BALINIT             644A
BALINIT:BITISCLEAR  648A
BALINIT:POSVEC      64A6
BALINIT:VELVEC      6496
BALPLOT             6622
BALPRV1             2C00
BALPRV2             2C02
BALRAD              14
BALUPD              64B6
BALUPD:CHKVERT      64D8
BALUPD:COLBOT       6500
BALUPD:COLLFT       64F6
BALUPD:COLRGT       64EC
BALUPD:COLTOP       650C
BALUPD:DONE         661C
BALUPD:PLRCOLISION  6592
BALUPD:SHIELDCOLISION  6518
BALVEL              3
CALTURA             F
CANCHURA            64
CHECKTIMER          6248
DIBUJAR             63F2
DMMALLOC            738C
DMMALLOC:END        73A4
DMMBNUM             32
DMMBSIZE            40
DMMDATA             6680
DMMFCOM             7366
DMMFFND             7374
DMMFIRST            7320
DMMFLOOP            735A
DMMFRCOM            7330
DMMFREE             73A6
DMMFRFND            733E
DMMFRLOP            7324
DMMFRSTO            7356
DMMINIT             7300
DMMINIT:LOOP        730C
DMMNEXT             7340
DMMNEXTO            7376
DMMSYSID            0
DSPLZ1              12C
DSPLZ2              6E
ENATP               5E6C
ENFPS               5E52
ERROR               5E48
FILENAMEPIX         4E20
FILENAMEWIN         4E32
FILLOAD             627E
FPS                 32
FPSAC               5E4A
FPSAN               5E54
FPSIN               5E4E
FPSUPD              5F32
FPSUPD:AA           5F5E
FPSUPD:CA           5F80
FPSUPD:FF           5F98
FPSUPD:ND           5F52
FPSUPD:SN           5F90
FPSUPD:TN           5F6E
FPSUPD:TRAP         5F9E
GAMEOVER1           2C6A
GAMEOVER2           2CA3
GAMEOVER3           2CE0
GAMEOVER4           2D26
GAMEOVER5           2D6A
GRAVEDAD            2
KBDDOWN             53
KBDEDGE             5E5B
KBDINIT             60C6
KBDLEFT             41
KBDREAD             60E0
KBDREAD:CHECKLIST   6144
KBDREAD:CHECKTIMER2  61B2
KBDREAD:DIB         6172
KBDREAD:DIB2        615A
KBDREAD:ENABLE      61D0
KBDREAD:FIN1        61C6
KBDREAD:LOOP        6122
KBDREAD:RETURN      6118
KBDREAD:SHIELDPLOT  612C
KBDREAD:STORE       611E
KBDRIGHT            44
KBDSHIELD           20
KBDTRAP             0
KBDUP               57
KBDVAL              5E5A
LASTENA             5E6E
LOOPDIB             6424
LOOPDIB1            6310
MOUSEINIT           61DC
MOUSEPOSX           5E70
MOUSEPOSY           5E72
MOUSETRAP           2
MOVIMIENTO          5E82
NOT_PRESSED         625A
PINIT               7582
PINIT1              759A
PINIT2              75B2
PIXEL               2E20
PLRDMG              5E62
PLRENER             5E60
PLRHEIGH            1E
PLRINIT             6350
PLRPOSX             5E5C
PLRPOSY             5E5E
PLRSPEEDX           6
PLRSPEEDY           14
PLRUPD              6364
PLRUPD:CHKDN        63C6
PLRUPD:CHKRT        63AC
PLRUPD:CHKUP        6390
PLRUPD:FINAL        63EC
PLRUPD:MDONE        63D6
PLRWIDTH            1E
PLTEN               5E84
PLTEN1              5E86
POINT               5E6A
PPLOT               76B0
PRESSED             6222
PUPDATE             75CA
PUPDATE1            763C
PUPDATE1:F          7662
PUPDATE1:FIN        76AA
PUPDATE1:UPAUX      765E
PUPDATE:F           75EE
PUPDATE:FIN         7636
PUPDATE:UPAUX       75EC
RANDVEC             73BC
RETURN              6346
REVISION            61F6
SCRCYCCT            5E45
SCRHEIGH            1E0
SCRINIT             5E94
SCRINTCT            5E44
SCRIRQ              1
SCRISR              5E8A
SCRPLOT             5FA4
SCRPLOT:CHECKPOINT  603C
SCRPLOT:CHECKPOINT2  6088
SCRPLOT:POSIBLEROJO  602E
SCRPLOT:ROJO        60B0
SCRPLOT:VERDE       6016
SCRTRAP             1
SCRUPD              6260
SCRWIDTH            280
SEGUNDOS            5E68
SHIELD              2C0C
SHIELDATA           2D
SHIELDCOOLDOWN      5E7A
SHIELDENA           5E76
SHIELDINICIO        5E7C
SHIELDPOSX          50
SHIELDPOSY          0
SHIELDTIMEEN        5E78
STACUR              5E56
STANEXT             5E58
START               76F0
START:II            77AE
START:III           77DA
START:IV            77DE
START:LOOP          775C
START:TT            777A
START:WINT          7814
START:YA            785C
TELEPORT            2C17
TIMEENABLE          5E74
TIMER               2C04
TXT2FPS             2C60
TXTFPS              2C24
UTLCHCOL            74EA
UTLCHCOL:END        7518
UTLCHCOL:NOCOL      7516
UTLINIT             74BE
UTLRAND             74D2
UTLRNDIX            74BC
VGRAVEDAD           5E64
VTIMER              5E66
WIN                 62A8
WIN1                2DA4
WIN2                2DDB
WIN:DIBUJAR         62F6
WINPIX              3E20
X                   1000
X1                  4E44
XCENTER             5E7E
Y                   1E00
Y1                  5644
YCENTER             5E80
